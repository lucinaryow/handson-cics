      *$PP-NOLIST
      *$PP-DEF CARCPP HA COPY SUPPRESS
      *$PP
      *$PP-LIST
      *  CBL XOPTS(COBOL2)
      *$PP-NOLIST							REALCICS
      *$PP-DEF CICS HA CICS Internal Data				REALCICS
      *$PP-DEF CICS HI CICS Internal Code				REALCICS
      *$PP-DEF CICS NA CICS Generated					REALCICS
      *  EXEC commands are standard PP-NOLIST				REALCICS
      *$PP-LIST 							REALCICS
      *$PP-NOLIST CICS HI						REALCICS
      *$NOMOVELINK,COMP-4,NOCALL					REALCICS
      *$DIALECT-VS2							REALCICS
      *$NOBLL4K 							REALCICS
      *$EBCDIC								REALCICS
      *$DCHK								REALCICS
      *$NOTRUNC 							REALCICS
      *$PP-LIST CICS HI 						REALCICS
       IDENTIFICATION DIVISION.
       PROGRAM-ID. SM03P.

       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       SOURCE-COMPUTER.    IBM-PC.
       OBJECT-COMPUTER.    IBM-PC.
       DATA DIVISION.
       WORKING-STORAGE SECTION.
      *$PP-NOLIST CICS HA						REALCICS
       01  DFH-RETURN-STATUS PIC S9(4) COMP-5.				REALCICS
       01  CICSICB.							REALCICS
	   05 DFH-ICB-SIZE PIC S9(9) BINARY VALUE 0.			REALCICS
	   05 DFH-MODULE-INFO.						REALCICS
	      10 DFH-VERSION PIC S9(4) COMP-4 VALUE 6001.		REALCICS
              10 DFH-MODULE-ID PIC X(8) VALUE 'SM03P'.                  REALCICS
              10 DFH-VAR-CODESET PIC X VALUE 'A'.                       REALCICS
              10 DFH-CODE-TYPE PIC X VALUE '2'.                         REALCICS
	      10 DFH-CICSTYPE PIC S9(4) COMP-4 VALUE 1. 		REALCICS
	      10 DFH-LEVEL PIC S9(4) COMP-4 VALUE 05.			REALCICS
	   05 DFH-COMMAND PIC XX.					REALCICS
	   05 DFH-DEBUG-DATA.						REALCICS
	      10 DFH-SOURCE-NAME PIC X(8).				REALCICS
	      10 DFH-SOURCE-LINE-NUM PIC 9(6) COMP-4.			REALCICS
	   05 DFH-RESULT-STATUS PIC S9(4) COMP-4.			REALCICS
	   05 DFH-RESERVED PIC X(512) VALUE LOW-VALUE.			REALCICS
	   05 DFH-RESULT REDEFINES DFH-RESERVED.			REALCICS
	      10 DFH-RESP PIC S9(8) COMP-4.				REALCICS
	      10 DFH-RESP2 PIC S9(8) COMP-4.				REALCICS
	      10 DFH-WORK-01 PIC S9(9) COMP-5.				REALCICS
	      10 DFH-WORK-01U REDEFINES DFH-WORK-01 PIC 9(9) COMP-5.	REALCICS
	   05 DFH-VARS-COUNT PIC S9(4) COMP-4.				REALCICS
	   05 DFH-VARS-MAX VALUE 24 PIC S9(4) COMP-4.			REALCICS
	   05 DFH-VARS OCCURS 24.					REALCICS
	      10 DFH-FLAG PIC S9(4) COMP-4.				REALCICS
	      10 DFH-DATA-TYPE PIC X.					REALCICS
	      10 DFH-DATA-CLASS PIC X.					REALCICS
	      10 DFH-DEBUG POINTER.					REALCICS
	      10 DFH-ADDR POINTER.					REALCICS
	      10 DFH-SIZE PIC S9(9) COMP-4.				REALCICS
	      10 DFH-DATA PIC X(8).					REALCICS
	      10 DFH-DATA1 REDEFINES DFH-DATA PIC X(1). 		REALCICS
	      10 DFH-DATA2 REDEFINES DFH-DATA PIC X(2). 		REALCICS
	      10 DFH-DATA4 REDEFINES DFH-DATA PIC X(4). 		REALCICS
	      10 DFH-DATA7 REDEFINES DFH-DATA PIC X(7). 		REALCICS
	      10 DFH-DATA8 REDEFINES DFH-DATA PIC X(8). 		REALCICS
	      10 DFH-DATAF REDEFINES DFH-DATA PIC S9(9) COMP-4. 	REALCICS
	      10 DFH-DATAH REDEFINES DFH-DATA PIC S9(4) COMP-4. 	REALCICS
	      10 DFH-LABEL REDEFINES DFH-DATA PIC S9(4) COMP-4. 	REALCICS
	      10 DFH-DATAT REDEFINES DFH-DATA PIC S9(15) COMP-3.	REALCICS
	      10 FILLER REDEFINES DFH-DATA.				REALCICS
		  15 DFH-DATAP PIC S9(6) COMP-3.			REALCICS
		  15 FILLER PIC X(4).					REALCICS
      *$PP-LIST CICS HA 						REALCICS
       01  WS-CURRENT-MAP  VALUE 'SM002'         PIC X(7).
       01  WS-TIME					 PIC 9(15) COMP-3.
       01  WS-DATE				 PIC 9(8).
       01  WS-DATE-X REDEFINES WS-DATE		 PIC X(8).
       01  WS-LENGTH				 PIC S9(4) COMP.
       01  WS-END				 PIC X(14) VALUE
           'END PROCESSING'.
       01  WS-MAPFAIL				 PIC X(20) VALUE
           'MAPFAIL ERROR'.
       01  WS-INVALID					 PIC X(14) VALUE
           'INVALID ACCESS'.
       01  WS-COMMAREA.
	   05  WS-USERID1			  PIC X(7).
	   05  WS-TICKET-NUM.
	       10  WS-TICKET-NUM1		  PIC X(6).
	       10  FILLER			  PIC X.
	   05  WS-PROG-STATE			  PIC 9(1).
           05  WS-INIT                            PIC X VALUE 'Y'.
	   05  WS-TCKID 			  PIC X(6).
	   05  WS-TCKREQ			  PIC X(8).
	   05  WS-TCKSTAT			  PIC X(10).
	   05  WS-TCKTTL			  PIC X(25).
	   05  WS-TCKDESC			  PIC X(100).
	   05  WS-LSTUPD			  PIC X(20).
	   05  WS-STUPDBY			  PIC X(8).
	   05  WS-LSTUPDRMK			  PIC X(50).
	   05  WS-REQUESTOR			  PIC X.
	   05  WS-ADMINISTRATOR 		  PIC X.
	   05  WS-APPROVER			  PIC X.
	   05  WS-SERVICE-PROVIDER		  PIC X.

       01  WS-FIELD01.
	   05 WS-STF01TCKID			 PIC X(6).
	   05 WS-STF01TCKIDR REDEFINES WS-STF01TCKID PIC 9(06).
	   05 WS-STF01TCKREQ			 PIC X(8).
	   05 WS-STF01TCKSTAT			 PIC X(10).
	   05 WS-STF01TCKTTL			 PIC X(25).
	   05 WS-STF01TCKDESC			 PIC X(100).
	   05 WS-STF01LSTUPD			 PIC X(20).
	   05 WS-STF01LSTUPDBY			 PIC X(8).
	   05 WS-STF01LSTUPDRMK 		 PIC X(50).

       01  WS-TIX-REC.
	   05  TIX-ID				 PIC X(06).
	   05  TIX-REQUESTOR			 PIC X(08).
	   05  TIX-STATUS			 PIC X(10).
	   05  TIX-TITLE			 PIC X(25).
	   05  TIX-DESC 			 PIC X(100).
	   05  TIX-DESC-RED REDEFINES TIX-DESC.
	       10  TIX-DESC1			 PIC X(50).
	       10  TIX-DESC2			 PIC X(50).
	   05  LAST-UPDATE			 PIC X(20).
	   05  LAST-UPDATE-RED REDEFINES LAST-UPDATE.
	       10  LAST-UPDATE-DATE		 PIC X(11).
	       10  LAST-UPDATE-TIME		 PIC X(09).
	   05  UPDATED-BY2.
	       10  UPDBY2			 PIC X(7).
	       10  FILLER			 PIC X.
	   05  LAST-UPDATE-REM			 PIC X(50).
	   05  LAST-UPDATE-REMW REDEFINES LAST-UPDATE-REM.
	       10  LAST-UPDATE-REM1		 PIC X(25).
	       10  LAST-UPDATE-REM2		 PIC X(25).

	01  WS-USER-REC.
	   05  USERID.
	       10  USERID1			 PIC X(7).
	       10  FILLER			 PIC X.
	   05  REQUESTOR			 PIC X.
	   05  ADMINISTRATOR			 PIC X.
	   05  APPROVER 			 PIC X.
	   05  SERVICE-PROVIDER 		 PIC X.
	   05  UPDATED-BY1.
	       10  UPDBY1			 PIC X(7).
	       10  FILLER			 PIC X.

       01  WS-LOG.
	   05  LOG-TIX-ID.
	       10  LOG-TIX-ID1			 PIC X(6).
	       10  LOG-SEQ-NUM			 PIC 9(3).
	   05  LOG-LAST-UPDATE.
	       10  LOG-LAST-UPDATE-DATE 	 PIC X(10).
	       10  LOG-LAST-UPDATE-TIME 	 PIC X(10).
	   05  LOG-UPDATED-BY.
	       10  LOG-UPDBY2			 PIC X(7).
	       10  FILLER			 PIC X.
	   05  LOG-LAST-UPDATE-REM		 PIC X(50).
	   05  FILLER				 PIC X(02).

       01  WS-LOG-PH				 PIC X(9).
       01  WS-LOG-PH2 REDEFINES WS-LOG-PH.
	   05  WS-LOG-ID			 PIC 9(6).
	   05  WS-LOG-SEQ			 PIC 9(3).

       01  WS-HV				 PIC X(20).
       01  WS-RES-CODE				 PIC S9(8) COMP.
       01  WS-ENTRCTR				 PIC 9(1) VALUE 0.
       01  WS-HDATE				 PIC 9(10).
       01  WS-HDATE-X REDEFINES WS-HDATE	 PIC X(10).
       01  WS-HTIME				PIC 9(15).
       01  WS-HTIME-X REDEFINES WS-HTIME	 PIC X(8).

      *
      P    COPY SM003.
      *$PP-START-COPY C:\handson-cics\CAWB30\SM003.COB
      * SYMBOLIC MAP of sm003 Created by CACXBMS Version 6.0.27
       01  SM003MI.
	   02  FILLER				      PIC X(12).
	   02  ERRMSGL				      PIC S9(4) COMP.
	   02  ERRMSGF				      PIC X.
	   02  FILLER REDEFINES ERRMSGF.
	       03  ERRMSGA			      PIC X.
	   02  ERRMSGI				      PIC X(058).
	   02  PF2L				      PIC S9(4) COMP.
	   02  PF2F				      PIC X.
	   02  FILLER REDEFINES PF2F.
	       03  PF2A 			      PIC X.
	   02  PF2I				      PIC X(012).
	   02  PF3L				      PIC S9(4) COMP.
	   02  PF3F				      PIC X.
	   02  FILLER REDEFINES PF3F.
	       03  PF3A 			      PIC X.
	   02  PF3I				      PIC X(010).
	   02  PF5L				      PIC S9(4) COMP.
	   02  PF5F				      PIC X.
	   02  FILLER REDEFINES PF5F.
	       03  PF5A 			      PIC X.
	   02  PF5I				      PIC X(011).
	   02  DATEL				      PIC S9(4) COMP.
	   02  DATEF				      PIC X.
	   02  FILLER REDEFINES DATEF.
	       03  DATEA			      PIC X.
	   02  DATEI				      PIC X(010).
	   02  TIMEL				      PIC S9(4) COMP.
	   02  TIMEF				      PIC X.
	   02  FILLER REDEFINES TIMEF.
	       03  TIMEA			      PIC X.
	   02  TIMEI				      PIC X(008).
	   02  TIXNUML				      PIC S9(4) COMP.
	   02  TIXNUMF				      PIC X.
	   02  FILLER REDEFINES TIXNUMF.
	       03  TIXNUMA			      PIC X.
	   02  TIXNUMI				      PIC X(006).
	   02  REQBYL				      PIC S9(4) COMP.
	   02  REQBYF				      PIC X.
	   02  FILLER REDEFINES REQBYF.
	       03  REQBYA			      PIC X.
	   02  REQBYI				      PIC X(007).
	   02  TIXTTLL				      PIC S9(4) COMP.
	   02  TIXTTLF				      PIC X.
	   02  FILLER REDEFINES TIXTTLF.
	       03  TIXTTLA			      PIC X.
	   02  TIXTTLI				      PIC X(025).
	   02  TIXDESC1L			      PIC S9(4) COMP.
	   02  TIXDESC1F			      PIC X.
	   02  FILLER REDEFINES TIXDESC1F.
	       03  TIXDESC1A			      PIC X.
	   02  TIXDESC1I			      PIC X(040).
	   02  TIXDESC2L			      PIC S9(4) COMP.
	   02  TIXDESC2F			      PIC X.
	   02  FILLER REDEFINES TIXDESC2F.
	       03  TIXDESC2A			      PIC X.
	   02  TIXDESC2I			      PIC X(040).
	   02  STATL				      PIC S9(4) COMP.
	   02  STATF				      PIC X.
	   02  FILLER REDEFINES STATF.
	       03  STATA			      PIC X.
	   02  STATI				      PIC X(009).
	   02  UPDBYL				      PIC S9(4) COMP.
	   02  UPDBYF				      PIC X.
	   02  FILLER REDEFINES UPDBYF.
	       03  UPDBYA			      PIC X.
	   02  UPDBYI				      PIC X(007).
	   02  UPDRMKL				      PIC S9(4) COMP.
	   02  UPDRMKF				      PIC X.
	   02  FILLER REDEFINES UPDRMKF.
	       03  UPDRMKA			      PIC X.
	   02  UPDRMKI				      PIC X(025).
	   02  UPDRMK1L 			      PIC S9(4) COMP.
	   02  UPDRMK1F 			      PIC X.
	   02  FILLER REDEFINES UPDRMK1F.
	       03  UPDRMK1A			      PIC X.
	   02  UPDRMK1I 			      PIC X(025).
	   02  DATE1L				      PIC S9(4) COMP.
	   02  DATE1F				      PIC X.
	   02  FILLER REDEFINES DATE1F.
	       03  DATE1A			      PIC X.
	   02  DATE1I				      PIC X(010).
	   02  TIME1L				      PIC S9(4) COMP.
	   02  TIME1F				      PIC X.
	   02  FILLER REDEFINES TIME1F.
	       03  TIME1A			      PIC X.
	   02  TIME1I				      PIC X(009).
       01  SM003MO REDEFINES SM003MI.
	   02  FILLER				      PIC X(12).
	   02  FILLER				      PIC XX.
	   02  FILLER				      PIC X.
	   02  ERRMSGO				      PIC X(058).
	   02  FILLER				      PIC XX.
	   02  FILLER				      PIC X.
	   02  PF2O				      PIC X(012).
	   02  FILLER				      PIC XX.
	   02  FILLER				      PIC X.
	   02  PF3O				      PIC X(010).
	   02  FILLER				      PIC XX.
	   02  FILLER				      PIC X.
	   02  PF5O				      PIC X(011).
	   02  FILLER				      PIC XX.
	   02  FILLER				      PIC X.
	   02  DATEO				      PIC X(010).
	   02  FILLER				      PIC XX.
	   02  FILLER				      PIC X.
	   02  TIMEO				      PIC X(008).
	   02  FILLER				      PIC XX.
	   02  FILLER				      PIC X.
	   02  TIXNUMO				      PIC X(006).
	   02  FILLER				      PIC XX.
	   02  FILLER				      PIC X.
	   02  REQBYO				      PIC X(007).
	   02  FILLER				      PIC XX.
	   02  FILLER				      PIC X.
	   02  TIXTTLO				      PIC X(025).
	   02  FILLER				      PIC XX.
	   02  FILLER				      PIC X.
	   02  TIXDESC1O			      PIC X(040).
	   02  FILLER				      PIC XX.
	   02  FILLER				      PIC X.
	   02  TIXDESC2O			      PIC X(040).
	   02  FILLER				      PIC XX.
	   02  FILLER				      PIC X.
	   02  STATO				      PIC X(009).
	   02  FILLER				      PIC XX.
	   02  FILLER				      PIC X.
	   02  UPDBYO				      PIC X(007).
	   02  FILLER				      PIC XX.
	   02  FILLER				      PIC X.
	   02  UPDRMKO				      PIC X(025).
	   02  FILLER				      PIC XX.
	   02  FILLER				      PIC X.
	   02  UPDRMK1O 			      PIC X(025).
	   02  FILLER				      PIC XX.
	   02  FILLER				      PIC X.
	   02  DATE1O				      PIC X(010).
	   02  FILLER				      PIC XX.
	   02  FILLER				      PIC X.
	   02  TIME1O				      PIC X(009).
      *$PP-END-COPY
      *
      P    COPY DFHAID.
      *$PP-START-COPY C:\HANDSON-CICS\CAWB30\CICSCOPY\DFHAID.COB
       01  DFHAID.
      *
      * CA-Realia CICS 6.0 Computer Associates International, Inc.
      *
      * Revision Information
      * ^{File:dfhaid.cob  }
      * ^{Timestamp:Thu May 15 14:02:52 1997}
      * ^{Revision:2.0}
      *
      *This is the AID constants copy file
      *
           05  DFHENTER                  PIC X VALUE ''''.
      * 				 value APOST
           05  DFHCLEAR                  PIC X VALUE '_'.
           05  DFHPA1                    PIC X VALUE '%'.
           05  DFHPA2                    PIC X VALUE '>'.
           05  DFHPA3                    PIC X VALUE ','.
           05  DFHPF1                    PIC X VALUE '1'.
           05  DFHPF2                    PIC X VALUE '2'.
           05  DFHPF3                    PIC X VALUE '3'.
           05  DFHPF4                    PIC X VALUE '4'.
           05  DFHPF5                    PIC X VALUE '5'.
           05  DFHPF6                    PIC X VALUE '6'.
           05  DFHPF7                    PIC X VALUE '7'.
           05  DFHPF8                    PIC X VALUE '8'.
           05  DFHPF9                    PIC X VALUE '9'.
           05  DFHPF10                   PIC X VALUE ':'.
           05  DFHPF11                   PIC X VALUE '#'.
           05  DFHPF12                   PIC X VALUE '@'.
           05  DFHPF13                   PIC X VALUE 'A'.
           05  DFHPF14                   PIC X VALUE 'B'.
           05  DFHPF15                   PIC X VALUE 'C'.
           05  DFHPF16                   PIC X VALUE 'D'.
           05  DFHPF17                   PIC X VALUE 'E'.
           05  DFHPF18                   PIC X VALUE 'F'.
           05  DFHPF19                   PIC X VALUE 'G'.
           05  DFHPF20                   PIC X VALUE 'H'.
           05  DFHPF21                   PIC X VALUE 'I'.
           05  DFHPF22                   PIC X VALUE '›'.
      *                                  EBCDIC Cent sign x'4A'
      *                                  ASCII  Cent sign x'9B'
           05  DFHPF23                   PIC X VALUE '.'.
           05  DFHPF24                   PIC X VALUE '<'.
           05  DFHOPID                   PIC X VALUE 'W'.
           05  DFHMSRE                   PIC X VALUE 'X'.
           05  DFHTRIG                   PIC X VALUE '"'.
      *                                        value QUOTE  "
           05  DFHPEN                    PIC X VALUE '='.
           05  DFHCLRP                   PIC X VALUE 'Ý'.
      *                                  EBCDIC x'6A'
      *                                  ASCII  x'DD'
           05  DFHSTRF                   PIC X VALUE 'h'.
      *    DFHQUIT is a CA-Realia CICS Extension
      *    It is set by using <Ctrl>+C or <Ctrl>+<Break> Keys
           05  DFHQUIT                   PIC X VALUE '!'.
	   05  DFHNULL			 PIC X VALUE LOW-VALUE.
      *$PP-END-COPY
      *
      PCOPY DFHBMSCA.
      *$PP-START-COPY C:\HANDSON-CICS\CAWB30\CICSCOPY\DFHBMSCA.COB
       01  DFHBMSCA.
      *
      * CA-Realia CICS 6.0 Computer Associates International, Inc.
      *
      * Revision Information
      * ^{File:dfhbmsca.cob}
      * ^{Timestamp:Tue Oct 08 15:34:54 1996}
      * ^{Revision:2.0}
      *
      *  Note:This FILE is provided with most values as quoted literals
      *       so that the file can be used for both ASCII and EBCDIC
      *       programs
      *
      *       The only exceptions are some 3270 Data Stream Orders
      *       They use different Hexadecimal values for ASCII and
      *       EBCDIC and they cannot be expressed as quoted literals
      *       as the values are <Line Feed>, <Tab>, <End of File> etc.
      *       characters in ASCII
      *
      *       They have their values set up to default to the EBCDIC
      *       values.
      *
      *       3270 orders are only needed for EXEC CICS SEND and RECEIVE
      *       and SEND TEXT with imbedded format orders.
      *       If you use these values in ASCII programs the values
      *       must be changed.
      *
      *       An alternative is to use REPLACING to change the values.
      *
      *    i.e. COPY DFHBMSCA replacing
      * 		     ==005== BY ==009==  *> DFHPT
      * 		     ==021== BY ==010==  *> DFHNL
      * 		     ==040== BY ==021==  *> DFHSA
      * 		     ==041== BY ==031==  *> DFHSFE
      * 		     ==044== BY ==023==  *> DFHMF
      * 		     ==060== BY ==020==  *> DFHRA
      * 		     ==063== BY ==026==. *> DFHSUB
      *
      ******************************************************************
      *BMS and Terminal Control - Order & Attributes constants	       *
      ******************************************************************
      *
      *    Field Attributes
      *
           05  DFHBMASB                          PIC X VALUE '8'.
           05  DFHBMASF                          PIC X VALUE '1'.
           05  DFHBMASK                          PIC X VALUE '0'.
           05  DFHBMBRY                          PIC X VALUE 'H'.
           05  DFHBMDAR                          PIC X VALUE '<'.
           05  DFHBMFSE                          PIC X VALUE 'A'.
           05  DFHBMPRF                          PIC X VALUE '/'.
           05  DFHBMPRO                          PIC X VALUE '-'.
           05  DFHBMUNN                          PIC X VALUE '&'.
           05  DFHBMUNP                          PIC X VALUE ' '.
           05  DFHUNNUM                          PIC X VALUE 'J'.
      *
      *    partially supported
      *
           05  DFHUNNOD                          PIC X VALUE '('.
           05  DFHUNIMD                          PIC X VALUE 'I'.
           05  DFHUNINT                          PIC X VALUE 'R'.
           05  DFHUNNON                          PIC X VALUE '('.
           05  DFHPROTI                          PIC X VALUE 'Y'.
           05  DFHPROTN                          PIC X VALUE '%'.
      *
      *    These values are additions to mainframe constants
      *
           05  DFHBMS-ASK-DARK                   PIC X VALUE '@'.
           05  DFHBMS-ASK-BRY-FSET               PIC X VALUE '9'.
           05  DFHBMS-ASK-DAR-FSET               PIC X VALUE ''''.
      * 					       VALUE APOST
           05  DFHBMS-PRO-BRY-FSET               PIC X VALUE 'Z'.
           05  DFHBMS-PRO-DAR-FSET               PIC X VALUE '_'.
           05  DFHBMS-NUM-BRY                    PIC X VALUE 'Q'.
           05  DFHBMS-NUM-DAR                    PIC X VALUE '*'.
           05  DFHBMS-NUM-DAR-FSET               PIC X VALUE ')'.
      *
      *    Field Flag values
	   05  DFHBMEOF-VAL VALUE 128		 PIC S9(4) COMP-4.
	   05  FILLER REDEFINES DFHBMEOF-VAL.
	       10  FILLER			 PIC X.
	       10  DFHBMEOF			 PIC X.
      *                                          x'80'.
	   05  DFHBMCUR-VAL VALUE 002		 PIC S9(4) COMP-4.
	   05  FILLER REDEFINES DFHBMCUR-VAL.
	       10  FILLER			 PIC X.
	       10  DFHBMCUR			 PIC X.
      *                                          x'02'.
	   05  DFHBMMEC-VAL VALUE 130		 PIC S9(4) COMP-4.
	   05  FILLER REDEFINES DFHBMMEC-VAL.
	       10  FILLER			 PIC X.
	       10  DFHBMMEC			 PIC X.
      *                                          x'82'.
      *                                          x'02'.
	   05  DFHBMFLG-VAL  VALUE 0		 PIC S9(4) COMP-4.
	       88  DFHERASE			 VALUES 128 130.
      *                                          x'80' X'82'
	       88  DFHCURSR			 VALUES 002 130.
      *                                          x'02' X'82'
	   05  FILLER REDEFINES DFHBMFLG-VAL.
	       10  FILLER			 PIC X.
	       10  DFHBMFLG			 PIC X.

	   05  DFHBMDUP-VAL VALUE 028		 PIC S9(4) COMP-4.
	   05  FILLER REDEFINES DFHBMDUP-VAL.
	       10  FILLER			 PIC X.
	       10  DFHBMDUP			 PIC X.
      *                                              x'1C'
      *
      ******************************************************************
      *    supported 327X Extended Attributes
      *
      *    Extended COLOR Attributes
      *
           05  DFHDFCOL                          PIC X VALUE '0'.
           05  DFHBLUE                           PIC X VALUE '1'.
           05  DFHRED                            PIC X VALUE '2'.
           05  DFHPINK                           PIC X VALUE '3'.
           05  DFHGREEN                          PIC X VALUE '4'.
           05  DFHTURQ                           PIC X VALUE '5'.
           05  DFHYELLO                          PIC X VALUE '6'.
           05  DFHNEUTR                          PIC X VALUE '7'.
      *
      *    Extended HILIGHT Attributes
      *
           05  DFHDFHI                           PIC X VALUE '0'.
           05  DFHBLINK                          PIC X VALUE '1'.
           05  DFHREVRS                          PIC X VALUE '2'.
           05  DFHUNDLN                          PIC X VALUE '4'.
      *
      ******************************************************************
      *    supported 327X Data Stream Orders
      *
	   05  DFHSBA-VAL VALUE 017		  PIC S9(4) COMP-4.
	   05  FILLER REDEFINES DFHSBA-VAL.
	       10  FILLER			 PIC X.
	       10  DFHSBA			 PIC X.
      *                                              x'11'
	   05  DFHEUA-VAL VALUE 018		 PIC S9(4) COMP-4.
	   05  FILLER REDEFINES DFHEUA-VAL.
	       10  FILLER			 PIC X.
	       10  DFHEUA			 PIC X.
      *                                              x'12'
	   05  DFHIC-VAL VALUE 019		 PIC S9(4) COMP-4.
	   05  FILLER REDEFINES DFHIC-VAL.
	       10  FILLER			 PIC X.
	       10  DFHIC			 PIC X.
      *                                              X'13'.
	   05  DFHSF-VAL VALUE 029		 PIC S9(4) COMP-4.
	   05  FILLER REDEFINES DFHSF-VAL.
	       10  FILLER			 PIC X.
	       10  DFHSF			 PIC X.
      *                                              X'1D'.
	   05  DFHPT-VAL VALUE 005		 PIC S9(4) COMP-4.
	       88 DFHPT-VAL-EBCDIC		 VALUE 5.
	       88 DFHPT-VAL-ASCII		 VALUE 9.
	   05  FILLER REDEFINES DFHPT-VAL.
	       10  FILLER			 PIC X.
	       10  DFHPT			 PIC X.
      *                                              EBCDIC X'05'.
      *                                              ASCII  X'09'.
	   05  DFHRA-VAL VALUE 060		 PIC S9(4) COMP-4.
	       88 DFHRA-VAL-EBCDIC		 VALUE 60.
	       88 DFHRA-VAL-ASCII		 VALUE 20.
	   05  FILLER REDEFINES DFHRA-VAL.
	       10  FILLER			 PIC X.
	       10  DFHRA			 PIC X.
      *                                              EBCDIC x'3C'
      *                                              ASCII  x'14'
	   05  DFHSFE-VAL VALUE 041		 PIC S9(4) COMP-4.
	       88 DFHSFE-VAL-EBCDIC		 VALUE 41.
	       88 DFHSFE-VAL-ASCII		 VALUE 31.
	   05  FILLER REDEFINES DFHSFE-VAL.
	       10  FILLER			 PIC X.
	       10  DFHSFE			 PIC X.
      *                                              EBCDIC x'29'
      *                                              ASCII  x'1F'
	   05  DFHMF-VAL VALUE 044		 PIC S9(4) COMP-4.
	       88 DFHMF-VAL-EBCDIC		 VALUE 44.
	       88 DFHMF-VAL-ASCII		 VALUE 23.
	   05  FILLER REDEFINES DFHMF-VAL.
	       10  FILLER			 PIC X.
	       10  DFHMF			 PIC X.
      *                                              EBCDIC x'2C'
      *                                              ASCII  x'17'
      *
      ******************************************************************
      *    unsupported 327X Data Stream order codes
      *
	   05  DFHSA-VAL VALUE 040		 PIC S9(4) COMP-4.
	       88 DFHSA-VAL-EBCDIC		 VALUE 40.
	       88 DFHSA-VAL-ASCII		 VALUE 21.
	   05  FILLER REDEFINES DFHSA-VAL.
	       10  FILLER			 PIC X.
	       10  DFHSA			 PIC X.
      *                                              EBCDIC x'28'
      *                                              ASCII  x'15'
	   05  DFHGE-VAL VALUE 008		 PIC S9(4) COMP-4.
	   05  FILLER REDEFINES DFHGE-VAL.
	       10  FILLER			 PIC X.
	       10  DFHGE			 PIC X.
      *                                              X'08'.
      *
      ******************************************************************
      *    SFE and MF supported attribute types
      *
           05  DFHCOLOR                          PIC X VALUE 'ƒ'.
      *                                              EBCDIC x'42'
      *                                              ASCII  x'83'
           05  DFHHLT                            PIC X VALUE 'Ö'.
      *                                              EBCDIC x'41'
      *                                              ASCII  x'D6'
           05  DFH3270                           PIC X VALUE '{'.
      *
      *    supported for SEND TEXT command and printer terminal
      *
	   05  DFHBMPNL-VAL VALUE 021		 PIC S9(4) COMP-4.
	       88 DFHBMPNL-VAL-EBCDIC		 VALUE 21.
	       88 DFHBMPNL-VAL-ASCII		 VALUE 10.
	   05  FILLER REDEFINES DFHBMPNL-VAL.
	       10  FILLER			 PIC X.
	       10  DFHBMPNL			 PIC X.
      *                                              EBCDIC X'15'.
      *                                              ASCII  X'0A'.
      *
      ******************************************************************
      *    Printer terminal data stream only
      *
	   05  DFHBMPFF-VAL VALUE 012		 PIC S9(4) COMP-4.
	   05  FILLER REDEFINES DFHBMPFF-VAL.
	       10  FILLER			 PIC X.
	       10  DFHBMPFF			 PIC X.
      *                                              X'0C'.
	   05  DFHBMPCR-VAL VALUE 013		 PIC S9(4) COMP-4.
	   05  FILLER REDEFINES DFHBMPCR-VAL.
	       10  FILLER			 PIC X.
	       10  DFHBMPCR			 PIC X.
      *                                              X'0D'.
	   05  DFHBMPEM-VAL VALUE 025		 PIC S9(4) COMP-4.
	   05  FILLER REDEFINES DFHBMPEM-VAL.
	       10  FILLER			 PIC X.
	       10  DFHBMPEM			 PIC X.
      *                                              X'19'.
      *
      ******************************************************************
      *    unsupported Miscellaneous attributes and constants
      *
	   05  DFHALL				 PIC X VALUE LOW-VALUES.
           05  DFHBASE                           PIC X VALUE '0'.
	   05  DFHBMDET 			 PIC X VALUE LOW-VALUES.
	   05  DFHBMPSOSI-VAL VALUE 3599	 PIC S9(4) COMP-4.
	   05  FILLER REDEFINES DFHBMPSOSI-VAL.
	       10  DFHBMPSO			 PIC X.
      *                                              X'0E'.
	       10  DFHBMPSI			 PIC X.
      *                                              X'0F'.
	   05  DFHDFT VALUE HIGH-VALUES 	 PIC X.
           05  DFHERROR                          PIC X VALUE '¶'.
      *                                              EBCDIC X'1A'.
      *                                              ASCII  X'B6'.
           05  DFHFIL                            PIC X VALUE '4'.
           05  DFHMENT                           PIC X VALUE '2'.
           05  DFHMET                            PIC X VALUE '3'.
           05  DFHMFE                            PIC X VALUE '6'.
           05  DFHMFET                           PIC X VALUE '7'.
           05  DFHMFT                            PIC X VALUE '5'.
           05  DFHMT                             PIC X VALUE '1'.
           05  DFHOUTLN                          PIC X VALUE 'B'.
           05  DFHPS                             PIC X VALUE '„'.
      *                                              EBCDIC x'43'
      *                                              ASCII  x'84'
           05  DFHVAL                            PIC X VALUE 'A'.
      *
	   05  DFHSUB-VAL   VALUE 063		 PIC S9(4) COMP-4.
	       88 DFHSUB-VAL-EBCDIC		 VALUE 63.
	       88 DFHSUB-VAL-ASCII		 VALUE 26.
	   05  FILLER REDEFINES DFHSUB-VAL.
	       10  FILLER			 PIC X.
	       10  DFHSUB			 PIC X.
      *                                              EBCDIC X'3F'.
      *                                              ASCII  X'1A'.
      *
	   05  DFHFM-VAL    VALUE 030		 PIC S9(4) COMP-4.
	   05  FILLER REDEFINES DFHFM-VAL.
	       10  FILLER			 PIC X.
	       10  DFHFM			 PIC X.
      *                                              EBCDIC X'1E'.
	   05  DFHEO VALUE HIGH-VALUE		 PIC X.
      *$PP-END-COPY

       LINKAGE SECTION.
      *$PP-START-INSERT CICS NA 					REALCICS
       01  DFHEIBLK.							REALCICS
	   05 EIBTIME  PIC S9(7) COMP-3.				REALCICS
	   05 EIBDATE  PIC S9(7) COMP-3.				REALCICS
	   05 EIBTRNID PIC X(4).					REALCICS
	   05 EIBTASKN PIC S9(7) COMP-3.				REALCICS
	   05 EIBTRMID PIC X(4).					REALCICS
	   05 DFHEIGDI PIC S9(4) COMP-4.				REALCICS
	   05 EIBCPOSN PIC S9(4) COMP-4.				REALCICS
	   05 EIBCALEN PIC S9(4) COMP-4.				REALCICS
	   05 EIBAID   PIC X.						REALCICS
	   05 EIBFN    PIC X(2).					REALCICS
	   05 EIBRCODE PIC X(6).					REALCICS
	   05 EIBDS    PIC X(8).					REALCICS
	   05 EIBREQID PIC X(8).					REALCICS
	   05 EIBRSRCE PIC X(8).					REALCICS
	   05 EIBSYNC  PIC X.						REALCICS
	   05 EIBFREE  PIC X.						REALCICS
	   05 EIBRECV  PIC X.						REALCICS
	   05 EIBSEND  PIC X.						REALCICS
	   05 EIBATT   PIC X.						REALCICS
	   05 EIBEOC   PIC X.						REALCICS
	   05 EIBFMH   PIC X.						REALCICS
	   05 EIBCOMPL PIC X.						REALCICS
	   05 EIBSIG   PIC X.						REALCICS
	   05 EIBCONF  PIC X.						REALCICS
	   05 EIBERR   PIC X.						REALCICS
	   05 EIBERRCD PIC X(4).					REALCICS
	   05 EIBSYNRB PIC X.						REALCICS
	   05 EIBNODAT PIC X.						REALCICS
	   05 EIBRESP  PIC S9(8) COMP-4.				REALCICS
	   05 EIBRESP2 PIC S9(8) COMP-4.				REALCICS
	   05 EIBRLDBK PIC X.						REALCICS
	   05 EIBCARESERVED PIC X(32).					REALCICS
      *$PP-END-INSERT CICS NA						REALCICS
       01  DFHCOMMAREA				 PIC X(247).
      *
       PROCEDURE DIVISION						REALCICS
      *$PP-START-INSERT CICS NA 					REALCICS
	   USING DFHEIBLK DFHCOMMAREA.					REALCICS
      *$PP-END-INSERT CICS NA						REALCICS
      *$PP-NOLIST CICS HI						REALCICS
       DFH-ROUTINES SECTION.						REALCICS
       DFH-ENTRY.							REALCICS
           MOVE 'sm03p' TO DFH-SOURCE-NAME                              REALCICS
	   MOVE 0 TO DFH-SOURCE-LINE-NUM				REALCICS
	   MOVE LOW-VALUE TO DFH-COMMAND				REALCICS
           CALL 'Mli_GetLAdr' USING DFHEIBLK DFH-ADDR (1)               REALCICS
           CALL 'Mli_GetMaxLen' USING DFHCOMMAREA DFH-WORK-01           REALCICS
	   ADD 0 DFH-WORK-01 GIVING DFH-SIZE (1)			REALCICS
           CALL 'REALIA_GET_PARM_COUNT' USING DFH-WORK-01               REALCICS
	   ADD 0 DFH-WORK-01U GIVING DFH-FLAG (1)			REALCICS
	   MOVE 1 TO DFH-VARS-COUNT					REALCICS
	   MOVE LOW-VALUE TO DFH-COMMAND				REALCICS
           CALL 'CICS_Module_Init' USING CICSICB GIVING                 REALCICS
	       DFH-RETURN-STATUS					REALCICS
	   IF DFH-RETURN-STATUS < 0 STOP RUN END-IF			REALCICS
	   GO TO DFH-MAINLINE-ENTRY.					REALCICS
       DFH-GET-INFO.							REALCICS
           ENTRY 'CACX_GET_INFO_SM03P' USING DFHEIBLK.                  REALCICS
	   STRING DFH-MODULE-INFO DELIMITED BY SIZE INTO EIBCARESERVED	REALCICS
	   GOBACK.							REALCICS
       DFH-MAINLINE-ENTRY SECTION.					REALCICS
      *$PP-LIST CICS HI 						REALCICS
       100-PROCESS.

      *$PP-DEBUG							REALCICS
      P    EXEC CICS IGNORE CONDITION
      P 	     ERROR
      P    END-EXEC
      *$PP-NOLIST							REALCICS
           MOVE 'SM03P' TO DFH-SOURCE-NAME                              REALCICS
	   MOVE 125 TO DFH-SOURCE-LINE-NUM				REALCICS
	   MOVE 001 TO DFH-FLAG (02)					REALCICS
           MOVE '0' TO DFH-DATA-TYPE (02)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (02)                              REALCICS
           MOVE X'020A' TO DFH-COMMAND EIBFN                            REALCICS
	   MOVE 002 TO DFH-VARS-COUNT					REALCICS
           CALL 'CICS_Exec_HANDLE' USING CICSICB GIVING                 REALCICS
	       DFH-RETURN-STATUS					REALCICS
	   IF DFH-RETURN-STATUS < 0 STOP RUN				REALCICS
	   ELSE IF DFH-RETURN-STATUS > 0 PERFORM DFH-GOTO-HANDLE	REALCICS
	       END-IF END-IF						REALCICS
      *$PP-LIST 							REALCICS

	   MOVE DFHCOMMAREA TO WS-COMMAREA
	   PERFORM 1000-VALIDATION
           IF EIBTRNID = 'SM00' OR 'SM01' OR 'SM03' OR  'SM012'
	       IF EIBCALEN NOT = +0


                 IF WS-PROG-STATE = '1'
                   MOVE 'ENTER TICKET NUMBER AND PRESS ENTER' TO ERRMSGO
		   MOVE WS-TICKET-NUM TO TIXNUMO
		   MOVE WS-TCKREQ TO REQBYO
		   MOVE WS-TCKSTAT TO STATO
		   MOVE WS-TCKTTL TO TIXTTLO
		   MOVE WS-TCKDESC(1:50) TO TIXDESC1O
		   MOVE WS-TCKDESC(51:50) TO TIXDESC2O
		   MOVE WS-LSTUPD(1:10) TO DATE1O
		   MOVE WS-LSTUPD(11:10) TO TIME1O
		   MOVE WS-LSTUPDRMK(1:25) TO UPDRMKO
		   MOVE WS-LSTUPDRMK(26:25) TO UPDRMK1O

                   IF WS-TICKET-NUM = '0'
		    MOVE SPACES TO TIXNUMO
		   END-IF

		   MOVE 2 TO WS-PROG-STATE
		   PERFORM 110-NEW-MAP
		 ELSE
		   MOVE WS-TICKET-NUM TO TIXNUMO
		   PERFORM 200-REC-MAP
		 END-IF
	       END-IF
	   ELSE
      *$PP-DEBUG							REALCICS
      P        EXEC CICS SEND TEXT
      P 	    FROM (WS-INVALID)
      P 	    LENGTH (+15)
      P 	    ERASE
      P        END-EXEC
      *$PP-NOLIST							REALCICS
           MOVE 'SM03P' TO DFH-SOURCE-NAME                              REALCICS
	   MOVE 160 TO DFH-SOURCE-LINE-NUM				REALCICS
	   MOVE 001 TO DFH-FLAG (02)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (02)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (02)                              REALCICS
	   SET DFH-ADDR (02) TO ADDRESS OF WS-INVALID			REALCICS
	   ADD 0 LENGTH OF WS-INVALID GIVING DFH-SIZE (02)		REALCICS
	   MOVE 001 TO DFH-FLAG (03)					REALCICS
           MOVE '8' TO DFH-DATA-TYPE (03)                               REALCICS
           MOVE 'H ' TO DFH-DATA-CLASS (03)                             REALCICS
	   ADD 0 +15 GIVING DFH-DATAH (03)				REALCICS
	   SET DFH-ADDR (03) TO ADDRESS OF DFH-DATAH (03)		REALCICS
	   ADD 0 LENGTH OF DFH-DATAH (03) GIVING DFH-SIZE (03)		REALCICS
	   MOVE 001 TO DFH-FLAG (06)					REALCICS
           MOVE '0' TO DFH-DATA-TYPE (06)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (06)                              REALCICS
	   MOVE 003 TO DFH-FLAG (13)					REALCICS
           MOVE '0' TO DFH-DATA-TYPE (13)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (13)                              REALCICS
           MOVE X'1806' TO DFH-COMMAND EIBFN                            REALCICS
	   MOVE 013 TO DFH-VARS-COUNT					REALCICS
           CALL 'CICS_Exec_Std' USING CICSICB GIVING DFH-RETURN-STATUS  REALCICS
           IF DFH-RETURN-STATUS = -1 CALL 'CICS_Link_Abend' USING       REALCICS
	       CICSICB END-IF						REALCICS
	   IF DFH-RETURN-STATUS < 0 STOP RUN				REALCICS
	   ELSE IF DFH-RETURN-STATUS > 0 PERFORM DFH-GOTO-HANDLE	REALCICS
	       END-IF END-IF						REALCICS
      *$PP-LIST 							REALCICS
      *$PP-DEBUG							REALCICS
      P        EXEC CICS RETURN
      P        END-EXEC
      *$PP-NOLIST							REALCICS
           MOVE 'SM03P' TO DFH-SOURCE-NAME                              REALCICS
	   MOVE 165 TO DFH-SOURCE-LINE-NUM				REALCICS
           MOVE X'0E08' TO DFH-COMMAND EIBFN                            REALCICS
	   MOVE 000 TO DFH-VARS-COUNT					REALCICS
           CALL 'CICS_Exec_Std' USING CICSICB GIVING DFH-RETURN-STATUS  REALCICS
           IF DFH-RETURN-STATUS = -1 CALL 'CICS_Link_Abend' USING       REALCICS
	       CICSICB END-IF						REALCICS
	   IF DFH-RETURN-STATUS < 0 STOP RUN				REALCICS
	   ELSE IF DFH-RETURN-STATUS > 0 PERFORM DFH-GOTO-HANDLE	REALCICS
	       END-IF END-IF						REALCICS
      *$PP-LIST 							REALCICS
	   END-IF.



       110-NEW-MAP.
           IF WS-PROG-STATE = '3'
	    PERFORM 700-READ-FILE

	    IF TIXTTLI = LOW-VALUES
	     MOVE TIX-TITLE TO TIXTTLI
	    END-IF

	    IF REQBYI = LOW-VALUES
	     MOVE TIX-REQUESTOR TO REQBYI
	    END-IF

	    IF TIXDESC1I = LOW-VALUES
	     MOVE TIX-DESC1 TO TIXDESC1I
	    END-IF

	    IF TIXDESC2I = LOW-VALUES
	     MOVE TIX-DESC2 TO TIXDESC2I
	    END-IF

	    IF STATI = LOW-VALUES
	     MOVE TIX-STATUS TO STATI
	    END-IF

	    IF UPDRMKI = LOW-VALUES
	     MOVE LAST-UPDATE-REM1 TO UPDRMKI
	    END-IF

	    IF UPDRMK1I = LOW-VALUES
	     MOVE LAST-UPDATE-REM2 TO UPDRMK1I
	    END-IF

	     MOVE WS-TICKET-NUM1 TO TIXNUMI
	   END-IF


	       MOVE EIBDATE TO WS-DATE.
	   MOVE WS-DATE-X TO DATEO.
      *$PP-DEBUG							REALCICS
      P    EXEC CICS ASKTIME
      P     ABSTIME (WS-TIME)
      P    END-EXEC
      *$PP-NOLIST							REALCICS
           MOVE 'SM03P' TO DFH-SOURCE-NAME                              REALCICS
	   MOVE 209 TO DFH-SOURCE-LINE-NUM				REALCICS
	   MOVE 001 TO DFH-FLAG (02)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (02)                               REALCICS
           MOVE 'T ' TO DFH-DATA-CLASS (02)                             REALCICS
	   SET DFH-ADDR (02) TO ADDRESS OF WS-TIME			REALCICS
	   ADD 0 LENGTH OF WS-TIME GIVING DFH-SIZE (02) 		REALCICS
           MOVE X'4A02' TO DFH-COMMAND EIBFN                            REALCICS
	   MOVE 002 TO DFH-VARS-COUNT					REALCICS
           CALL 'CICS_Exec_Std' USING CICSICB GIVING DFH-RETURN-STATUS  REALCICS
           IF DFH-RETURN-STATUS = -1 CALL 'CICS_Link_Abend' USING       REALCICS
	       CICSICB END-IF						REALCICS
	   IF DFH-RETURN-STATUS < 0 STOP RUN				REALCICS
	   ELSE IF DFH-RETURN-STATUS > 0 PERFORM DFH-GOTO-HANDLE	REALCICS
	       END-IF END-IF						REALCICS
      *$PP-LIST 							REALCICS

      *$PP-DEBUG							REALCICS
      P    EXEC CICS FORMATTIME
      P     ABSTIME (WS-TIME)
      P     DATESEP ('-')
      P     MMDDYY (DATEO)
      P     TIME (TIMEO)
      P     TIMESEP (':')
      P    END-EXEC
      *$PP-NOLIST							REALCICS
           MOVE 'SM03P' TO DFH-SOURCE-NAME                              REALCICS
	   MOVE 213 TO DFH-SOURCE-LINE-NUM				REALCICS
	   MOVE 001 TO DFH-FLAG (02)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (02)                               REALCICS
           MOVE 'T ' TO DFH-DATA-CLASS (02)                             REALCICS
	   SET DFH-ADDR (02) TO ADDRESS OF WS-TIME			REALCICS
	   ADD 0 LENGTH OF WS-TIME GIVING DFH-SIZE (02) 		REALCICS
	   MOVE 001 TO DFH-FLAG (09)					REALCICS
           MOVE '8' TO DFH-DATA-TYPE (09)                               REALCICS
           MOVE '1 ' TO DFH-DATA-CLASS (09)                             REALCICS
           MOVE '-' TO DFH-DATA1 (09)                                   REALCICS
	   SET DFH-ADDR (09) TO ADDRESS OF DFH-DATA1 (09)		REALCICS
	   ADD 0 LENGTH OF DFH-DATA1 (09) GIVING DFH-SIZE (09)		REALCICS
	   MOVE 001 TO DFH-FLAG (07)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (07)                               REALCICS
           MOVE '8 ' TO DFH-DATA-CLASS (07)                             REALCICS
	   SET DFH-ADDR (07) TO ADDRESS OF DATEO			REALCICS
	   ADD 0 LENGTH OF DATEO GIVING DFH-SIZE (07)			REALCICS
	   MOVE 001 TO DFH-FLAG (15)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (15)                               REALCICS
           MOVE '8 ' TO DFH-DATA-CLASS (15)                             REALCICS
	   SET DFH-ADDR (15) TO ADDRESS OF TIMEO			REALCICS
	   ADD 0 LENGTH OF TIMEO GIVING DFH-SIZE (15)			REALCICS
	   MOVE 001 TO DFH-FLAG (17)					REALCICS
           MOVE '8' TO DFH-DATA-TYPE (17)                               REALCICS
           MOVE '1 ' TO DFH-DATA-CLASS (17)                             REALCICS
           MOVE ':' TO DFH-DATA1 (17)                                   REALCICS
	   SET DFH-ADDR (17) TO ADDRESS OF DFH-DATA1 (17)		REALCICS
	   ADD 0 LENGTH OF DFH-DATA1 (17) GIVING DFH-SIZE (17)		REALCICS
           MOVE X'4A04' TO DFH-COMMAND EIBFN                            REALCICS
	   MOVE 017 TO DFH-VARS-COUNT					REALCICS
           CALL 'CICS_Exec_Std' USING CICSICB GIVING DFH-RETURN-STATUS  REALCICS
           IF DFH-RETURN-STATUS = -1 CALL 'CICS_Link_Abend' USING       REALCICS
	       CICSICB END-IF						REALCICS
	   IF DFH-RETURN-STATUS < 0 STOP RUN				REALCICS
	   ELSE IF DFH-RETURN-STATUS > 0 PERFORM DFH-GOTO-HANDLE	REALCICS
	       END-IF END-IF						REALCICS
      *$PP-LIST 							REALCICS

	   MOVE DFHBMASB TO TIMEA
	   MOVE DFHBMASB TO DATEA

      *$PP-DEBUG							REALCICS
      P    EXEC CICS
      P     SEND MAP('SM003M')
      P     MAPSET('SM003')
      P     FROM(SM003MO)
      P
      P     ERASE
      P    END-EXEC
      *$PP-NOLIST							REALCICS
           MOVE 'SM03P' TO DFH-SOURCE-NAME                              REALCICS
	   MOVE 224 TO DFH-SOURCE-LINE-NUM				REALCICS
	   MOVE 001 TO DFH-FLAG (02)					REALCICS
           MOVE '8' TO DFH-DATA-TYPE (02)                               REALCICS
           MOVE '7 ' TO DFH-DATA-CLASS (02)                             REALCICS
           MOVE 'SM003M' TO DFH-DATA7 (02)                              REALCICS
	   SET DFH-ADDR (02) TO ADDRESS OF DFH-DATA7 (02)		REALCICS
	   ADD 0 LENGTH OF DFH-DATA7 (02) GIVING DFH-SIZE (02)		REALCICS
	   MOVE 001 TO DFH-FLAG (03)					REALCICS
           MOVE '8' TO DFH-DATA-TYPE (03)                               REALCICS
           MOVE '7 ' TO DFH-DATA-CLASS (03)                             REALCICS
           MOVE 'SM003' TO DFH-DATA7 (03)                               REALCICS
	   SET DFH-ADDR (03) TO ADDRESS OF DFH-DATA7 (03)		REALCICS
	   ADD 0 LENGTH OF DFH-DATA7 (03) GIVING DFH-SIZE (03)		REALCICS
	   MOVE 001 TO DFH-FLAG (04)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (04)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (04)                              REALCICS
	   SET DFH-ADDR (04) TO ADDRESS OF SM003MO			REALCICS
	   ADD 0 LENGTH OF SM003MO GIVING DFH-SIZE (04) 		REALCICS
	   MOVE 001 TO DFH-FLAG (09)					REALCICS
           MOVE '0' TO DFH-DATA-TYPE (09)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (09)                              REALCICS
	   MOVE 003 TO DFH-FLAG (18)					REALCICS
           MOVE '0' TO DFH-DATA-TYPE (18)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (18)                              REALCICS
           MOVE X'1804' TO DFH-COMMAND EIBFN                            REALCICS
	   MOVE 018 TO DFH-VARS-COUNT					REALCICS
           CALL 'CICS_Exec_Std' USING CICSICB GIVING DFH-RETURN-STATUS  REALCICS
           IF DFH-RETURN-STATUS = -1 CALL 'CICS_Link_Abend' USING       REALCICS
	       CICSICB END-IF						REALCICS
	   IF DFH-RETURN-STATUS < 0 STOP RUN				REALCICS
	   ELSE IF DFH-RETURN-STATUS > 0 PERFORM DFH-GOTO-HANDLE	REALCICS
	       END-IF END-IF						REALCICS
      *$PP-LIST 							REALCICS

      *$PP-DEBUG							REALCICS
      P    EXEC CICS RETURN
      P     TRANSID('SM03')
      P     COMMAREA(WS-COMMAREA)
      P    END-EXEC.
      *$PP-NOLIST							REALCICS
           MOVE 'SM03P' TO DFH-SOURCE-NAME                              REALCICS
	   MOVE 232 TO DFH-SOURCE-LINE-NUM				REALCICS
	   MOVE 001 TO DFH-FLAG (02)					REALCICS
           MOVE '8' TO DFH-DATA-TYPE (02)                               REALCICS
           MOVE '4 ' TO DFH-DATA-CLASS (02)                             REALCICS
           MOVE 'SM03' TO DFH-DATA4 (02)                                REALCICS
	   SET DFH-ADDR (02) TO ADDRESS OF DFH-DATA4 (02)		REALCICS
	   ADD 0 LENGTH OF DFH-DATA4 (02) GIVING DFH-SIZE (02)		REALCICS
	   MOVE 001 TO DFH-FLAG (04)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (04)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (04)                              REALCICS
	   SET DFH-ADDR (04) TO ADDRESS OF WS-COMMAREA			REALCICS
	   ADD 0 LENGTH OF WS-COMMAREA GIVING DFH-SIZE (04)		REALCICS
           MOVE X'0E08' TO DFH-COMMAND EIBFN                            REALCICS
	   MOVE 004 TO DFH-VARS-COUNT					REALCICS
           CALL 'CICS_Exec_Std' USING CICSICB GIVING DFH-RETURN-STATUS  REALCICS
           IF DFH-RETURN-STATUS = -1 CALL 'CICS_Link_Abend' USING       REALCICS
	       CICSICB END-IF						REALCICS
	   IF DFH-RETURN-STATUS < 0 STOP RUN				REALCICS
	   ELSE IF DFH-RETURN-STATUS > 0 PERFORM DFH-GOTO-HANDLE	REALCICS
	       END-IF END-IF						REALCICS
	   .								REALCICS
      *$PP-LIST 							REALCICS

       200-REC-MAP.
      *$PP-DEBUG							REALCICS
      P    EXEC CICS
      P        RECEIVE MAP('SM003M')
      P        MAPSET('SM003')
      P        INTO (SM003MI)
      P    END-EXEC
      *$PP-NOLIST							REALCICS
           MOVE 'SM03P' TO DFH-SOURCE-NAME                              REALCICS
	   MOVE 238 TO DFH-SOURCE-LINE-NUM				REALCICS
	   MOVE 001 TO DFH-FLAG (02)					REALCICS
           MOVE '8' TO DFH-DATA-TYPE (02)                               REALCICS
           MOVE '7 ' TO DFH-DATA-CLASS (02)                             REALCICS
           MOVE 'SM003M' TO DFH-DATA7 (02)                              REALCICS
	   SET DFH-ADDR (02) TO ADDRESS OF DFH-DATA7 (02)		REALCICS
	   ADD 0 LENGTH OF DFH-DATA7 (02) GIVING DFH-SIZE (02)		REALCICS
	   MOVE 001 TO DFH-FLAG (03)					REALCICS
           MOVE '8' TO DFH-DATA-TYPE (03)                               REALCICS
           MOVE '7 ' TO DFH-DATA-CLASS (03)                             REALCICS
           MOVE 'SM003' TO DFH-DATA7 (03)                               REALCICS
	   SET DFH-ADDR (03) TO ADDRESS OF DFH-DATA7 (03)		REALCICS
	   ADD 0 LENGTH OF DFH-DATA7 (03) GIVING DFH-SIZE (03)		REALCICS
	   MOVE 001 TO DFH-FLAG (04)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (04)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (04)                              REALCICS
	   SET DFH-ADDR (04) TO ADDRESS OF SM003MI			REALCICS
	   ADD 0 LENGTH OF SM003MI GIVING DFH-SIZE (04) 		REALCICS
	   MOVE 002 TO DFH-FLAG (05)					REALCICS
           MOVE '0' TO DFH-DATA-TYPE (05)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (05)                              REALCICS
           MOVE X'1802' TO DFH-COMMAND EIBFN                            REALCICS
	   MOVE 005 TO DFH-VARS-COUNT					REALCICS
           CALL 'CICS_Exec_Std' USING CICSICB GIVING DFH-RETURN-STATUS  REALCICS
           IF DFH-RETURN-STATUS = -1 CALL 'CICS_Link_Abend' USING       REALCICS
	       CICSICB END-IF						REALCICS
	   IF DFH-RETURN-STATUS < 0 STOP RUN				REALCICS
	   ELSE IF DFH-RETURN-STATUS > 0 PERFORM DFH-GOTO-HANDLE	REALCICS
	       END-IF END-IF						REALCICS
      *$PP-LIST 							REALCICS

	   IF EIBAID = DFHENTER
	    IF TIXNUMO = SPACES
             MOVE 'INVALID SPACES IN TIX NO' TO ERRMSGO
	    ELSE
              IF WS-PROG-STATE = '2'

	       MOVE TIXNUMO TO WS-TICKET-NUM1
	       PERFORM 300-VALIDATE-TICKET

              ELSE IF WS-PROG-STATE = '3'

	       PERFORM 600-VALIDATE-ENTRY

	      ELSE
	       MOVE SPACES TO WS-TICKET-NUM
	       MOVE SPACES TO WS-TCKID
	       MOVE SPACES TO WS-TCKREQ
	       MOVE SPACES TO WS-TCKSTAT
	       MOVE SPACES TO WS-TCKTTL
	       MOVE SPACES TO WS-TCKDESC
	       MOVE SPACES TO WS-LSTUPD
	       MOVE SPACES TO WS-STUPDBY
	       MOVE SPACES TO WS-LSTUPDRMK

	       MOVE SPACES TO TIXNUMO
	       MOVE SPACES TO REQBYO
	       MOVE SPACES TO STATO
	       MOVE SPACES TO TIXTTLO
	       MOVE SPACES TO TIXDESC1O
	       MOVE SPACES TO TIXDESC2O
	       MOVE SPACES TO DATE1O
	       MOVE SPACES TO TIME1O
	       MOVE SPACES TO UPDRMKO
	       MOVE SPACES TO UPDRMK1O
	       MOVE SPACES TO UPDBYO

	       MOVE DFHBMUNP TO TIXNUMA
	       MOVE DFHBMPRO TO REQBYA
	       MOVE DFHBMPRO TO STATA
	       MOVE DFHBMPRO TO TIXTTLA
	       MOVE DFHBMPRO TO TIXDESC1A
	       MOVE DFHBMPRO TO TIXDESC2A
	       MOVE DFHBMPRO TO DATE1A
	       MOVE DFHBMPRO TO TIME1A
	       MOVE DFHBMPRO TO UPDRMKA
	       MOVE DFHBMPRO TO UPDRMK1A

	       MOVE 2 TO WS-PROG-STATE
               MOVE 'ENTER TICKET NUMBER AND PRESS ENTER' TO ERRMSGO

	       PERFORM 110-NEW-MAP

	      END-IF

	    END-IF
	   END-IF
	   END-IF

	   IF EIBAID = DFHPF2
	    IF TIXNUMI = SPACES
             MOVE 'INVALID KEY PRESSED' TO ERRMSGO
	    ELSE
             IF WS-PROG-STATE = '3'

	      PERFORM 700-READ-FILE

	      IF STATO = LOW-VALUES
	       MOVE WS-TCKSTAT TO STATO
	      END-IF

	      IF TIXTTLO = LOW-VALUES AND TIXDESC1O = LOW-VALUES
	      AND TIXDESC2O = LOW-VALUES AND UPDRMKO = LOW-VALUES
	      AND UPDRMK1O = LOW-VALUES AND STATO = TIX-STATUS

               MOVE 'NO CHANGES' TO ERRMSGO
	      MOVE DFHBMUNP TO TIXTTLA
	      MOVE DFHBMUNP TO TIXDESC1A
	      MOVE DFHBMUNP TO TIXDESC2A
	      MOVE DFHBMUNP TO UPDRMKA
	      MOVE DFHBMUNP TO UPDRMK1A
	      MOVE DFHBMUNP TO STATA
	      MOVE WS-TCKTTL TO TIXTTLO
	      MOVE WS-TCKDESC(1:50) TO TIXDESC1O
	      MOVE WS-TCKDESC(51:50) TO TIXDESC2O
	      MOVE WS-LSTUPDRMK(1:25) TO UPDRMKO
	      MOVE WS-LSTUPDRMK(26:25) TO UPDRMK1O
	      MOVE WS-TCKSTAT TO STATO

	      ELSE
               IF STATO NOT = 'APPROVED'
               AND STATO NOT = 'ONGOING'
               AND STATO NOT = 'COMPLETED'

	       MOVE DFHBMUNP TO TIXTTLA
	       MOVE DFHBMUNP TO TIXDESC1A
	       MOVE DFHBMUNP TO TIXDESC2A
	       MOVE DFHBMUNP TO UPDRMKA
	       MOVE DFHBMUNP TO UPDRMK1A
	       MOVE DFHBMUNP TO STATA

	       MOVE TIXTTLO TO WS-TCKTTL
	       MOVE TIXDESC1O TO WS-TCKDESC(1:50)
	       MOVE TIXDESC2O TO WS-TCKDESC(51:50)
	       MOVE UPDRMKO TO WS-LSTUPDRMK(1:25)
	       MOVE UPDRMK1O TO WS-LSTUPDRMK(26:25)
	       MOVE STATO TO WS-TCKSTAT

	       MOVE WS-TCKTTL TO TIXTTLO
	       MOVE WS-TCKDESC(1:50) TO TIXDESC1O
	       MOVE WS-TCKDESC(51:50) TO TIXDESC2O
	       MOVE WS-LSTUPDRMK(1:25) TO UPDRMKO
	       MOVE WS-LSTUPDRMK(26:25) TO UPDRMK1O
	       MOVE WS-TCKSTAT TO STATO
               MOVE 'STATUS SHOULD BE ONGOING OR COMPLETED' TO ERRMSGO


	       ELSE
		MOVE EIBDATE TO WS-HDATE
      *$PP-DEBUG							REALCICS
      P 	EXEC CICS ASKTIME
      P 	 ABSTIME (WS-HTIME)
      P 	END-EXEC
      *$PP-NOLIST							REALCICS
           MOVE 'SM03P' TO DFH-SOURCE-NAME                              REALCICS
	   MOVE 362 TO DFH-SOURCE-LINE-NUM				REALCICS
	   MOVE 001 TO DFH-FLAG (02)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (02)                               REALCICS
           MOVE 'T ' TO DFH-DATA-CLASS (02)                             REALCICS
	   SET DFH-ADDR (02) TO ADDRESS OF WS-HTIME			REALCICS
	   ADD 0 LENGTH OF WS-HTIME GIVING DFH-SIZE (02)		REALCICS
           MOVE X'4A02' TO DFH-COMMAND EIBFN                            REALCICS
	   MOVE 002 TO DFH-VARS-COUNT					REALCICS
           CALL 'CICS_Exec_Std' USING CICSICB GIVING DFH-RETURN-STATUS  REALCICS
           IF DFH-RETURN-STATUS = -1 CALL 'CICS_Link_Abend' USING       REALCICS
	       CICSICB END-IF						REALCICS
	   IF DFH-RETURN-STATUS < 0 STOP RUN				REALCICS
	   ELSE IF DFH-RETURN-STATUS > 0 PERFORM DFH-GOTO-HANDLE	REALCICS
	       END-IF END-IF						REALCICS
      *$PP-LIST 							REALCICS

      *$PP-DEBUG							REALCICS
      P 	EXEC CICS FORMATTIME
      P 	 ABSTIME (WS-HTIME)
      P          DATESEP ('/')
      P 	 MMDDYYYY (WS-HDATE-X)
      P 	 TIME (WS-HTIME)
      P          TIMESEP (':')
      P 	END-EXEC
      *$PP-NOLIST							REALCICS
           MOVE 'SM03P' TO DFH-SOURCE-NAME                              REALCICS
	   MOVE 366 TO DFH-SOURCE-LINE-NUM				REALCICS
	   MOVE 001 TO DFH-FLAG (02)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (02)                               REALCICS
           MOVE 'T ' TO DFH-DATA-CLASS (02)                             REALCICS
	   SET DFH-ADDR (02) TO ADDRESS OF WS-HTIME			REALCICS
	   ADD 0 LENGTH OF WS-HTIME GIVING DFH-SIZE (02)		REALCICS
	   MOVE 001 TO DFH-FLAG (09)					REALCICS
           MOVE '8' TO DFH-DATA-TYPE (09)                               REALCICS
           MOVE '1 ' TO DFH-DATA-CLASS (09)                             REALCICS
           MOVE '/' TO DFH-DATA1 (09)                                   REALCICS
	   SET DFH-ADDR (09) TO ADDRESS OF DFH-DATA1 (09)		REALCICS
	   ADD 0 LENGTH OF DFH-DATA1 (09) GIVING DFH-SIZE (09)		REALCICS
	   MOVE 001 TO DFH-FLAG (22)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (22)                               REALCICS
           MOVE 'A ' TO DFH-DATA-CLASS (22)                             REALCICS
	   SET DFH-ADDR (22) TO ADDRESS OF WS-HDATE-X			REALCICS
	   ADD 0 LENGTH OF WS-HDATE-X GIVING DFH-SIZE (22)		REALCICS
	   MOVE 001 TO DFH-FLAG (15)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (15)                               REALCICS
           MOVE '8 ' TO DFH-DATA-CLASS (15)                             REALCICS
	   SET DFH-ADDR (15) TO ADDRESS OF WS-HTIME			REALCICS
	   ADD 0 LENGTH OF WS-HTIME GIVING DFH-SIZE (15)		REALCICS
	   MOVE 001 TO DFH-FLAG (17)					REALCICS
           MOVE '8' TO DFH-DATA-TYPE (17)                               REALCICS
           MOVE '1 ' TO DFH-DATA-CLASS (17)                             REALCICS
           MOVE ':' TO DFH-DATA1 (17)                                   REALCICS
	   SET DFH-ADDR (17) TO ADDRESS OF DFH-DATA1 (17)		REALCICS
	   ADD 0 LENGTH OF DFH-DATA1 (17) GIVING DFH-SIZE (17)		REALCICS
           MOVE X'4A04' TO DFH-COMMAND EIBFN                            REALCICS
	   MOVE 022 TO DFH-VARS-COUNT					REALCICS
           CALL 'CICS_Exec_Std' USING CICSICB GIVING DFH-RETURN-STATUS  REALCICS
           IF DFH-RETURN-STATUS = -1 CALL 'CICS_Link_Abend' USING       REALCICS
	       CICSICB END-IF						REALCICS
	   IF DFH-RETURN-STATUS < 0 STOP RUN				REALCICS
	   ELSE IF DFH-RETURN-STATUS > 0 PERFORM DFH-GOTO-HANDLE	REALCICS
	       END-IF END-IF						REALCICS
      *$PP-LIST 							REALCICS

		MOVE WS-HDATE-X TO LAST-UPDATE-DATE
		MOVE WS-HDATE-X TO DATE1O
		MOVE WS-HTIME-X TO LAST-UPDATE-TIME
		MOVE WS-HTIME-X TO TIME1O

	       PERFORM 800-CREATE-LOG

      *$PP-DEBUG							REALCICS
      P        EXEC CICS
      P         READ FILE('STF00001')
      P 	INTO (WS-TIX-REC)
      P 	RIDFLD (WS-TICKET-NUM1)
      P 	RESP(WS-RES-CODE)
      P 	EQUAL
      P 	UPDATE
      P        END-EXEC
      *$PP-NOLIST							REALCICS
           MOVE 'SM03P' TO DFH-SOURCE-NAME                              REALCICS
	   MOVE 381 TO DFH-SOURCE-LINE-NUM				REALCICS
	   MOVE 001 TO DFH-FLAG (02)					REALCICS
           MOVE '8' TO DFH-DATA-TYPE (02)                               REALCICS
           MOVE '8 ' TO DFH-DATA-CLASS (02)                             REALCICS
           MOVE 'STF00001' TO DFH-DATA8 (02)                            REALCICS
	   SET DFH-ADDR (02) TO ADDRESS OF DFH-DATA8 (02)		REALCICS
	   ADD 0 LENGTH OF DFH-DATA8 (02) GIVING DFH-SIZE (02)		REALCICS
	   MOVE 001 TO DFH-FLAG (04)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (04)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (04)                              REALCICS
	   SET DFH-ADDR (04) TO ADDRESS OF WS-TIX-REC			REALCICS
	   ADD 0 LENGTH OF WS-TIX-REC GIVING DFH-SIZE (04)		REALCICS
	   MOVE 001 TO DFH-FLAG (06)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (06)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (06)                              REALCICS
	   SET DFH-ADDR (06) TO ADDRESS OF WS-TICKET-NUM1		REALCICS
	   ADD 0 LENGTH OF WS-TICKET-NUM1 GIVING DFH-SIZE (06)		REALCICS
	   MOVE 001 TO DFH-FLAG (01)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (01)                               REALCICS
           MOVE 'H ' TO DFH-DATA-CLASS (01)                             REALCICS
	   SET DFH-ADDR (01) TO ADDRESS OF WS-RES-CODE			REALCICS
	   ADD 0 LENGTH OF WS-RES-CODE GIVING DFH-SIZE (01)		REALCICS
	   MOVE 002 TO DFH-FLAG (11)					REALCICS
           MOVE '0' TO DFH-DATA-TYPE (11)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (11)                              REALCICS
	   MOVE 001 TO DFH-FLAG (03)					REALCICS
           MOVE '0' TO DFH-DATA-TYPE (03)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (03)                              REALCICS
           MOVE X'0602' TO DFH-COMMAND EIBFN                            REALCICS
	   MOVE 011 TO DFH-VARS-COUNT					REALCICS
           CALL 'CICS_Exec_Std' USING CICSICB GIVING DFH-RETURN-STATUS  REALCICS
           IF DFH-RETURN-STATUS = -1 CALL 'CICS_Link_Abend' USING       REALCICS
	       CICSICB END-IF						REALCICS
	   IF DFH-RETURN-STATUS < 0 STOP RUN				REALCICS
	   ELSE IF DFH-RETURN-STATUS > 0 PERFORM DFH-GOTO-HANDLE	REALCICS
	       END-IF END-IF						REALCICS
	   ADD 0 DFH-RESP GIVING WS-RES-CODE				REALCICS
      *$PP-LIST 							REALCICS
		IF TIXTTLI NOT = LOW-VALUES
		 MOVE TIXTTLI TO TIX-TITLE
		END-IF

		IF TIXDESC1I NOT = LOW-VALUES
		 MOVE TIXDESC1I TO TIX-DESC1
		END-IF

		IF TIXDESC2I NOT = LOW-VALUES
		 MOVE TIXDESC2I TO TIX-DESC2
		END-IF

		IF STATO NOT = LOW-VALUES
		 MOVE STATO TO TIX-STATUS
		END-IF

		IF UPDRMKI NOT = LOW-VALUES
		 MOVE UPDRMKI TO LAST-UPDATE-REM1
		END-IF

		IF UPDRMK1I NOT = LOW-VALUES
		 MOVE UPDRMK1I TO LAST-UPDATE-REM2
		END-IF

		IF DATE1I NOT = LOW-VALUES
		 MOVE DATE1I TO LAST-UPDATE-DATE
		END-IF

		IF TIME1I NOT = LOW-VALUES
		 MOVE TIME1I TO LAST-UPDATE-TIME
		END-IF

		PERFORM 900-CREATE-LOG-2

      *$PP-DEBUG							REALCICS
      P 	EXEC CICS
      P         REWRITE FILE('STF00001')
      P 	 FROM(WS-TIX-REC)
      P 	 RESP(WS-RES-CODE)
      P 	END-EXEC
      *$PP-NOLIST							REALCICS
           MOVE 'SM03P' TO DFH-SOURCE-NAME                              REALCICS
	   MOVE 423 TO DFH-SOURCE-LINE-NUM				REALCICS
	   MOVE 001 TO DFH-FLAG (02)					REALCICS
           MOVE '8' TO DFH-DATA-TYPE (02)                               REALCICS
           MOVE '8 ' TO DFH-DATA-CLASS (02)                             REALCICS
           MOVE 'STF00001' TO DFH-DATA8 (02)                            REALCICS
	   SET DFH-ADDR (02) TO ADDRESS OF DFH-DATA8 (02)		REALCICS
	   ADD 0 LENGTH OF DFH-DATA8 (02) GIVING DFH-SIZE (02)		REALCICS
	   MOVE 001 TO DFH-FLAG (03)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (03)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (03)                              REALCICS
	   SET DFH-ADDR (03) TO ADDRESS OF WS-TIX-REC			REALCICS
	   ADD 0 LENGTH OF WS-TIX-REC GIVING DFH-SIZE (03)		REALCICS
	   MOVE 001 TO DFH-FLAG (01)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (01)                               REALCICS
           MOVE 'H ' TO DFH-DATA-CLASS (01)                             REALCICS
	   SET DFH-ADDR (01) TO ADDRESS OF WS-RES-CODE			REALCICS
	   ADD 0 LENGTH OF WS-RES-CODE GIVING DFH-SIZE (01)		REALCICS
           MOVE X'0606' TO DFH-COMMAND EIBFN                            REALCICS
	   MOVE 003 TO DFH-VARS-COUNT					REALCICS
           CALL 'CICS_Exec_Std' USING CICSICB GIVING DFH-RETURN-STATUS  REALCICS
           IF DFH-RETURN-STATUS = -1 CALL 'CICS_Link_Abend' USING       REALCICS
	       CICSICB END-IF						REALCICS
	   IF DFH-RETURN-STATUS < 0 STOP RUN				REALCICS
	   ELSE IF DFH-RETURN-STATUS > 0 PERFORM DFH-GOTO-HANDLE	REALCICS
	       END-IF END-IF						REALCICS
	   ADD 0 DFH-RESP GIVING WS-RES-CODE				REALCICS
      *$PP-LIST 							REALCICS

      *$PP-START-INSERT CICS NA 					REALCICS
      P 	 IF EIBRESP = DFHRESP(NORMAL)
      *$PP-END-INSERT CICS NA						REALCICS
		 IF EIBRESP =	      000				REALCICS
             MOVE 'TICKET UPDATED, PRESS ENTER TO UPDATE ANOTHER TICKET'
	     TO ERRMSGO
		  MOVE 4 TO WS-PROG-STATE

		 ELSE
                  MOVE 'ERROR UPDATE' TO ERRMSGO
		 END-IF


	     ELSE

              MOVE 'INVALID KEY PRESSED' TO ERRMSGO

	     END-IF

	    END-IF
	   END-IF.

       300-VALIDATE-TICKET.
      *$PP-DEBUG							REALCICS
      P    EXEC CICS
      P        READ FILE('STF00001')
      P        INTO (WS-TIX-REC)
      P        RIDFLD (WS-TICKET-NUM1)
      P        RESP(WS-RES-CODE)
      P        EQUAL
      P    END-EXEC
      *$PP-NOLIST							REALCICS
           MOVE 'SM03P' TO DFH-SOURCE-NAME                              REALCICS
	   MOVE 449 TO DFH-SOURCE-LINE-NUM				REALCICS
	   MOVE 001 TO DFH-FLAG (02)					REALCICS
           MOVE '8' TO DFH-DATA-TYPE (02)                               REALCICS
           MOVE '8 ' TO DFH-DATA-CLASS (02)                             REALCICS
           MOVE 'STF00001' TO DFH-DATA8 (02)                            REALCICS
	   SET DFH-ADDR (02) TO ADDRESS OF DFH-DATA8 (02)		REALCICS
	   ADD 0 LENGTH OF DFH-DATA8 (02) GIVING DFH-SIZE (02)		REALCICS
	   MOVE 001 TO DFH-FLAG (04)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (04)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (04)                              REALCICS
	   SET DFH-ADDR (04) TO ADDRESS OF WS-TIX-REC			REALCICS
	   ADD 0 LENGTH OF WS-TIX-REC GIVING DFH-SIZE (04)		REALCICS
	   MOVE 001 TO DFH-FLAG (06)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (06)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (06)                              REALCICS
	   SET DFH-ADDR (06) TO ADDRESS OF WS-TICKET-NUM1		REALCICS
	   ADD 0 LENGTH OF WS-TICKET-NUM1 GIVING DFH-SIZE (06)		REALCICS
	   MOVE 001 TO DFH-FLAG (01)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (01)                               REALCICS
           MOVE 'H ' TO DFH-DATA-CLASS (01)                             REALCICS
	   SET DFH-ADDR (01) TO ADDRESS OF WS-RES-CODE			REALCICS
	   ADD 0 LENGTH OF WS-RES-CODE GIVING DFH-SIZE (01)		REALCICS
	   MOVE 002 TO DFH-FLAG (11)					REALCICS
           MOVE '0' TO DFH-DATA-TYPE (11)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (11)                              REALCICS
           MOVE X'0602' TO DFH-COMMAND EIBFN                            REALCICS
	   MOVE 011 TO DFH-VARS-COUNT					REALCICS
           CALL 'CICS_Exec_Std' USING CICSICB GIVING DFH-RETURN-STATUS  REALCICS
           IF DFH-RETURN-STATUS = -1 CALL 'CICS_Link_Abend' USING       REALCICS
	       CICSICB END-IF						REALCICS
	   IF DFH-RETURN-STATUS < 0 STOP RUN				REALCICS
	   ELSE IF DFH-RETURN-STATUS > 0 PERFORM DFH-GOTO-HANDLE	REALCICS
	       END-IF END-IF						REALCICS
	   ADD 0 DFH-RESP GIVING WS-RES-CODE				REALCICS
      *$PP-LIST 							REALCICS
      *$PP-START-INSERT CICS NA 					REALCICS
      P    IF EIBRESP = DFHRESP(NOTFND)
      *$PP-END-INSERT CICS NA						REALCICS
	   IF EIBRESP = 	013					REALCICS

               MOVE 'TICKET NUMBER DOES NOT EXIST' TO ERRMSGO
	   ELSE
             IF TIX-STATUS = 'APPROVED' OR TIX-STATUS = 'ONGOING'
              IF WS-REQUESTOR = 'Y' OR WS-SERVICE-PROVIDER = 'Y'
               IF WS-REQUESTOR = 'Y' AND (WS-SERVICE-PROVIDER = 'N'
               AND WS-APPROVER = 'N' AND WS-ADMINISTRATOR = 'N')

		IF WS-USERID1 = WS-TCKREQ
		 PERFORM 500-TICKET-REC

		ELSE
                 MOVE 'INVALID ACCESS TO THE TICKET' TO ERRMSGO
		END-IF
               ELSE IF WS-SERVICE-PROVIDER = 'Y'
		 PERFORM 500-TICKET-REC

	       END-IF
	      ELSE

               MOVE 'INVALID ACCESS TO THE TICKET' TO ERRMSGO

	      END-IF
	     ELSE
               MOVE 'INVALID TICKET STATUS' TO ERRMSGO
	     END-IF

	   END-IF.

       400-SEARCH-USER.

      *$PP-DEBUG							REALCICS
      P    EXEC CICS ASSIGN
      P        USERID(WS-USERID1)
      P    END-EXEC
      *$PP-NOLIST							REALCICS
           MOVE 'SM03P' TO DFH-SOURCE-NAME                              REALCICS
	   MOVE 488 TO DFH-SOURCE-LINE-NUM				REALCICS
	   MOVE 080 TO DFH-FLAG (02)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (02)                               REALCICS
           MOVE '8 ' TO DFH-DATA-CLASS (02)                             REALCICS
	   SET DFH-ADDR (02) TO ADDRESS OF WS-USERID1			REALCICS
	   ADD 0 LENGTH OF WS-USERID1 GIVING DFH-SIZE (02)		REALCICS
           MOVE X'0208' TO DFH-COMMAND EIBFN                            REALCICS
	   MOVE 002 TO DFH-VARS-COUNT					REALCICS
           CALL 'CICS_Exec_Std' USING CICSICB GIVING DFH-RETURN-STATUS  REALCICS
           IF DFH-RETURN-STATUS = -1 CALL 'CICS_Link_Abend' USING       REALCICS
	       CICSICB END-IF						REALCICS
	   IF DFH-RETURN-STATUS < 0 STOP RUN				REALCICS
	   ELSE IF DFH-RETURN-STATUS > 0 PERFORM DFH-GOTO-HANDLE	REALCICS
	       END-IF END-IF						REALCICS
      *$PP-LIST 							REALCICS
      *$PP-DEBUG							REALCICS
      P    EXEC CICS
      P        READ FILE('UAF00001')
      P        INTO (WS-USER-REC)
      P        RIDFLD (WS-USERID1)
      P        RESP(WS-RES-CODE)
      P        GTEQ
      P    END-EXEC
      *$PP-NOLIST							REALCICS
           MOVE 'SM03P' TO DFH-SOURCE-NAME                              REALCICS
	   MOVE 491 TO DFH-SOURCE-LINE-NUM				REALCICS
	   MOVE 001 TO DFH-FLAG (02)					REALCICS
           MOVE '8' TO DFH-DATA-TYPE (02)                               REALCICS
           MOVE '8 ' TO DFH-DATA-CLASS (02)                             REALCICS
           MOVE 'UAF00001' TO DFH-DATA8 (02)                            REALCICS
	   SET DFH-ADDR (02) TO ADDRESS OF DFH-DATA8 (02)		REALCICS
	   ADD 0 LENGTH OF DFH-DATA8 (02) GIVING DFH-SIZE (02)		REALCICS
	   MOVE 001 TO DFH-FLAG (04)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (04)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (04)                              REALCICS
	   SET DFH-ADDR (04) TO ADDRESS OF WS-USER-REC			REALCICS
	   ADD 0 LENGTH OF WS-USER-REC GIVING DFH-SIZE (04)		REALCICS
	   MOVE 001 TO DFH-FLAG (06)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (06)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (06)                              REALCICS
	   SET DFH-ADDR (06) TO ADDRESS OF WS-USERID1			REALCICS
	   ADD 0 LENGTH OF WS-USERID1 GIVING DFH-SIZE (06)		REALCICS
	   MOVE 001 TO DFH-FLAG (01)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (01)                               REALCICS
           MOVE 'H ' TO DFH-DATA-CLASS (01)                             REALCICS
	   SET DFH-ADDR (01) TO ADDRESS OF WS-RES-CODE			REALCICS
	   ADD 0 LENGTH OF WS-RES-CODE GIVING DFH-SIZE (01)		REALCICS
	   MOVE 001 TO DFH-FLAG (11)					REALCICS
           MOVE '0' TO DFH-DATA-TYPE (11)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (11)                              REALCICS
           MOVE X'0602' TO DFH-COMMAND EIBFN                            REALCICS
	   MOVE 011 TO DFH-VARS-COUNT					REALCICS
           CALL 'CICS_Exec_Std' USING CICSICB GIVING DFH-RETURN-STATUS  REALCICS
           IF DFH-RETURN-STATUS = -1 CALL 'CICS_Link_Abend' USING       REALCICS
	       CICSICB END-IF						REALCICS
	   IF DFH-RETURN-STATUS < 0 STOP RUN				REALCICS
	   ELSE IF DFH-RETURN-STATUS > 0 PERFORM DFH-GOTO-HANDLE	REALCICS
	       END-IF END-IF						REALCICS
	   ADD 0 DFH-RESP GIVING WS-RES-CODE				REALCICS
      *$PP-LIST 							REALCICS
           IF WS-RES-CODE NOT = +00 OR (REQUESTOR = 'N'
           AND SERVICE-PROVIDER = 'N' AND APPROVER = 'N'
           AND ADMINISTRATOR = 'N')
      *$PP-DEBUG							REALCICS
      P        EXEC CICS SEND TEXT
      P 	   FROM (WS-INVALID)
      P 	   LENGTH (+25)
      P 	   ERASE
      P        END-EXEC
      *$PP-NOLIST							REALCICS
           MOVE 'SM03P' TO DFH-SOURCE-NAME                              REALCICS
	   MOVE 501 TO DFH-SOURCE-LINE-NUM				REALCICS
	   MOVE 001 TO DFH-FLAG (02)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (02)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (02)                              REALCICS
	   SET DFH-ADDR (02) TO ADDRESS OF WS-INVALID			REALCICS
	   ADD 0 LENGTH OF WS-INVALID GIVING DFH-SIZE (02)		REALCICS
	   MOVE 001 TO DFH-FLAG (03)					REALCICS
           MOVE '8' TO DFH-DATA-TYPE (03)                               REALCICS
           MOVE 'H ' TO DFH-DATA-CLASS (03)                             REALCICS
	   ADD 0 +25 GIVING DFH-DATAH (03)				REALCICS
	   SET DFH-ADDR (03) TO ADDRESS OF DFH-DATAH (03)		REALCICS
	   ADD 0 LENGTH OF DFH-DATAH (03) GIVING DFH-SIZE (03)		REALCICS
	   MOVE 001 TO DFH-FLAG (06)					REALCICS
           MOVE '0' TO DFH-DATA-TYPE (06)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (06)                              REALCICS
	   MOVE 003 TO DFH-FLAG (13)					REALCICS
           MOVE '0' TO DFH-DATA-TYPE (13)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (13)                              REALCICS
           MOVE X'1806' TO DFH-COMMAND EIBFN                            REALCICS
	   MOVE 013 TO DFH-VARS-COUNT					REALCICS
           CALL 'CICS_Exec_Std' USING CICSICB GIVING DFH-RETURN-STATUS  REALCICS
           IF DFH-RETURN-STATUS = -1 CALL 'CICS_Link_Abend' USING       REALCICS
	       CICSICB END-IF						REALCICS
	   IF DFH-RETURN-STATUS < 0 STOP RUN				REALCICS
	   ELSE IF DFH-RETURN-STATUS > 0 PERFORM DFH-GOTO-HANDLE	REALCICS
	       END-IF END-IF						REALCICS
      *$PP-LIST 							REALCICS
      *$PP-DEBUG							REALCICS
      P        EXEC CICS RETURN END-EXEC
      *$PP-NOLIST							REALCICS
           MOVE 'SM03P' TO DFH-SOURCE-NAME                              REALCICS
	   MOVE 506 TO DFH-SOURCE-LINE-NUM				REALCICS
           MOVE X'0E08' TO DFH-COMMAND EIBFN                            REALCICS
	   MOVE 000 TO DFH-VARS-COUNT					REALCICS
           CALL 'CICS_Exec_Std' USING CICSICB GIVING DFH-RETURN-STATUS  REALCICS
           IF DFH-RETURN-STATUS = -1 CALL 'CICS_Link_Abend' USING       REALCICS
	       CICSICB END-IF						REALCICS
	   IF DFH-RETURN-STATUS < 0 STOP RUN				REALCICS
	   ELSE IF DFH-RETURN-STATUS > 0 PERFORM DFH-GOTO-HANDLE	REALCICS
	       END-IF END-IF						REALCICS
      *$PP-LIST 							REALCICS
	   ELSE
            MOVE 'UPDATED BY THE USER' TO ERRMSGO

	    MOVE 1 TO WS-PROG-STATE
	   END-IF.

       500-TICKET-REC.

	   MOVE 3 TO WS-PROG-STATE
	   MOVE TIX-REQUESTOR TO WS-TCKREQ
	   MOVE TIX-STATUS TO WS-TCKSTAT
	   MOVE TIX-TITLE TO WS-TCKTTL
	   MOVE TIX-DESC TO WS-TCKDESC
	   MOVE LAST-UPDATE TO WS-LSTUPD
	   MOVE UPDATED-BY2 TO WS-STUPDBY
	   MOVE LAST-UPDATE-REMW TO WS-LSTUPDRMK

	   MOVE WS-TICKET-NUM1 TO TIXNUMO
	   MOVE WS-TCKREQ TO REQBYO
	   MOVE WS-TCKSTAT TO STATO
	   MOVE WS-TCKTTL TO TIXTTLO
	   MOVE WS-TCKDESC(1:50) TO TIXDESC1O
	   MOVE WS-TCKDESC(51:50) TO TIXDESC2O
	   MOVE WS-LSTUPD(1:10) TO DATE1O
	   MOVE WS-LSTUPD(11:10) TO TIME1O
	   MOVE WS-LSTUPDRMK(1:25) TO UPDRMKO
	   MOVE WS-LSTUPDRMK(26:25) TO UPDRMK1O
	   MOVE WS-STUPDBY TO UPDBYO

	   MOVE DFHBMPRO TO TIXNUMA
	   MOVE DFHBMUNP TO TIXTTLA
	   MOVE DFHBMUNP TO TIXDESC1A
	   MOVE DFHBMUNP TO TIXDESC2A
	   MOVE DFHBMUNP TO STATA
	   MOVE DFHBMUNP TO UPDRMKA
	   MOVE DFHBMUNP TO UPDRMK1A

           MOVE 'ENTER UPDATES' TO ERRMSGO.

       600-VALIDATE-ENTRY.

	   IF TIXTTLI = SPACES AND TIXDESC1I = SPACES
	   AND TIXDESC2I = SPACES
            MOVE 'REQUIRED FIELDS' TO ERRMSGO
	   ELSE

	    IF TIXTTLO = LOW-VALUES
	     MOVE WS-TCKTTL TO TIXTTLO
	    ELSE
	     MOVE TIXTTLO TO WS-TCKTTL
	    END-IF

	    IF TIXDESC1O = LOW-VALUES
	     MOVE WS-TCKDESC(1:50) TO TIXDESC1O
	    ELSE
	     MOVE TIXDESC1O TO WS-TCKDESC(1:50)
	    END-IF

	    IF TIXDESC2O = LOW-VALUES
	     MOVE WS-TCKDESC(51:50) TO TIXDESC2O
	    ELSE
	     MOVE TIXDESC2O TO WS-TCKDESC(51:50)
	    END-IF

	    IF STATO = LOW-VALUES
	     MOVE WS-TCKSTAT TO STATO
	    ELSE
	     MOVE STATO TO WS-TCKSTAT
	    END-IF

	    IF UPDRMKO = LOW-VALUES
	     MOVE WS-LSTUPDRMK(1:25) TO UPDRMKO
	    ELSE
	     MOVE UPDRMKO TO WS-LSTUPDRMK(1:25)
	    END-IF

	    IF UPDRMK1O = LOW-VALUES
	     MOVE WS-LSTUPDRMK(26:25) TO UPDRMK1O
	    ELSE
	     MOVE UPDRMK1O To WS-LSTUPDRMK(26:25)
	    END-IF


            IF STATO NOT = 'APPROVED'
            AND STATO NOT = 'ONGOING'
            AND STATO NOT = 'COMPLETED'

	      MOVE DFHBMUNP TO TIXTTLA
	      MOVE DFHBMUNP TO TIXDESC1A
	      MOVE DFHBMUNP TO TIXDESC2A
	      MOVE DFHBMUNP TO UPDRMKA
	      MOVE DFHBMUNP TO UPDRMK1A
	      MOVE DFHBMUNP TO STATA

	      MOVE TIXTTLO TO WS-TCKTTL
	      MOVE TIXDESC1O TO WS-TCKDESC(1:50)
	      MOVE TIXDESC2O TO WS-TCKDESC(51:50)
	      MOVE UPDRMKO TO WS-LSTUPDRMK(1:25)
	      MOVE UPDRMK1O TO WS-LSTUPDRMK(26:25)
	      MOVE STATO TO WS-TCKSTAT

	      MOVE WS-TCKTTL TO TIXTTLO
	      MOVE WS-TCKDESC(1:50) TO TIXDESC1O
	      MOVE WS-TCKDESC(51:50) TO TIXDESC2O
	      MOVE WS-LSTUPDRMK(1:25) TO UPDRMKO
	      MOVE WS-LSTUPDRMK(26:25) TO UPDRMK1O
	      MOVE WS-TCKSTAT TO STATO
              MOVE 'STATUS SHOULD BE ONGOING OR COMPLETED' TO ERRMSGO


	    ELSE
	       IF (TIXTTLO = SPACES OR TIXTTLO = LOW-VALUES)
	       AND (TIXDESC1O = SPACES OR TIXDESC1O = LOW-VALUES)
	       AND (TIXDESC2O = SPACES OR TIXDESC2O = LOW-VALUES OR
	       UPDRMK1O = SPACES OR UPDRMK1O = LOW-VALUES)

	       MOVE
               'TITLE AND DESCRIPTION ARE REQUIRED'
	       TO ERRMSGO
	       MOVE DFHBMUNP TO TIXTTLA
	       MOVE DFHBMUNP TO TIXDESC1A
	       MOVE DFHBMUNP TO TIXDESC2A
	       MOVE DFHBMUNP TO UPDRMKA
	       MOVE DFHBMUNP TO UPDRMK1A
	       MOVE DFHBMUNP TO STATA

	       ELSE IF (TIXTTLO = SPACES OR TIXTTLO = LOW-VALUES)
	       AND (TIXDESC1O = SPACES OR TIXDESC1O = LOW-VALUES)

	       MOVE
               'TITLE AND DESCRIPTION ARE REQUIRED' TO ERRMSGO

	       MOVE DFHBMUNP TO TIXTTLA
	       MOVE DFHBMUNP TO TIXDESC1A
	       MOVE DFHBMUNP TO TIXDESC2A
	       MOVE DFHBMUNP TO UPDRMKA
	       MOVE DFHBMUNP TO UPDRMK1A
	       MOVE DFHBMUNP TO STATA

	       ELSE IF (TIXTTLO = SPACES OR TIXTTLO = LOW-VALUES)
	       AND (UPDRMKO = SPACES OR UPDRMKO = LOW-VALUES)
	       AND (TIXDESC2O = SPACES OR TIXDESC2O = LOW-VALUES OR
	       UPDRMK1O = SPACES OR UPDRMK1O = LOW-VALUES)

	       MOVE
               'TITLE AND DESCRIPTION 2 OR RMK 2 ARE REQUIRED'
	       TO ERRMSGO

	       MOVE DFHBMUNP TO TIXTTLA
	       MOVE DFHBMUNP TO TIXDESC1A
	       MOVE DFHBMUNP TO TIXDESC2A
	       MOVE DFHBMUNP TO UPDRMKA
	       MOVE DFHBMUNP TO UPDRMK1A
	       MOVE DFHBMUNP TO STATA

	       ELSE IF (TIXTTLO = SPACES OR TIXTTLO = LOW-VALUES)
	       AND (TIXDESC1O = SPACES OR TIXDESC1O = LOW-VALUES)
	       AND (UPDRMKO = SPACES OR UPDRMKO = LOW-VALUES)

	       MOVE
               'TITLE, DESCRIPTION AND REMARKS ARE REQUIRED'
	       TO ERRMSGO

	       MOVE DFHBMUNP TO TIXTTLA
	       MOVE DFHBMUNP TO TIXDESC1A
	       MOVE DFHBMUNP TO TIXDESC2A
	       MOVE DFHBMUNP TO UPDRMKA
	       MOVE DFHBMUNP TO UPDRMK1A
	       MOVE DFHBMUNP TO STATA

	       ELSE IF TIXTTLO = SPACES OR TIXTTLO = LOW-VALUES

               MOVE 'TITLE IS REQUIRED' TO ERRMSGO

	       MOVE DFHBMUNP TO TIXTTLA
	       MOVE DFHBMUNP TO TIXDESC1A
	       MOVE DFHBMUNP TO TIXDESC2A
	       MOVE DFHBMUNP TO UPDRMKA
	       MOVE DFHBMUNP TO UPDRMK1A
	       MOVE DFHBMUNP TO STATA

	       ELSE IF TIXDESC1O = SPACES OR TIXDESC1O = LOW-VALUES

               MOVE 'DESCRIPTION IS REQUIRED' TO ERRMSGO

	       MOVE DFHBMUNP TO TIXTTLA
	       MOVE DFHBMUNP TO TIXDESC1A
	       MOVE DFHBMUNP TO TIXDESC2A
	       MOVE DFHBMUNP TO UPDRMKA
	       MOVE DFHBMUNP TO UPDRMK1A
	       MOVE DFHBMUNP TO STATA

	       ELSE IF UPDRMKO = SPACES OR UPDRMKO = LOW-VALUES

               MOVE 'UPDATE REMARK IS REQUIRED' TO ERRMSGO

	       MOVE DFHBMUNP TO TIXTTLA
	       MOVE DFHBMUNP TO TIXDESC1A
	       MOVE DFHBMUNP TO TIXDESC2A
	       MOVE DFHBMUNP TO UPDRMKA
	       MOVE DFHBMUNP TO UPDRMK1A
	       MOVE DFHBMUNP TO STATA

	     ELSE
	      PERFORM 700-READ-FILE
	      IF TIXTTLO = TIX-TITLE AND TIXDESC1O = TIX-DESC1
	      AND TIXDESC2O = TIX-DESC2 AND UPDRMKO = LAST-UPDATE-REM1
	      AND UPDRMK1O = LAST-UPDATE-REM2 AND STATO = TIX-STATUS

              MOVE 'NO CHANGES' TO ERRMSGO
	      MOVE DFHBMUNP TO TIXTTLA
	      MOVE DFHBMUNP TO TIXDESC1A
	      MOVE DFHBMUNP TO TIXDESC2A
	      MOVE DFHBMUNP TO UPDRMKA
	      MOVE DFHBMUNP TO UPDRMK1A
	      MOVE DFHBMUNP TO STATA
	      MOVE WS-TCKTTL TO TIXTTLO
	      MOVE WS-TCKDESC(1:50) TO TIXDESC1O
	      MOVE WS-TCKDESC(51:50) TO TIXDESC2O
	      MOVE WS-LSTUPDRMK(1:25) TO UPDRMKO
	      MOVE WS-LSTUPDRMK(26:25) TO UPDRMK1O
	      MOVE WS-TCKSTAT TO STATO


	      ELSE
               MOVE 'PRESS PF2 TO UPDATE TICKET' TO ERRMSGO
	       MOVE DFHBMUNP TO TIXTTLA
	       MOVE DFHBMUNP TO TIXDESC1A
	       MOVE DFHBMUNP TO TIXDESC2A
	       MOVE DFHBMUNP TO UPDRMKA
	       MOVE DFHBMUNP TO UPDRMK1A
	       MOVE DFHBMUNP TO STATA

               MOVE 'X' TO WS-INIT
	      END-IF

	     END-IF
	    END-IF
	   END-IF.

       700-READ-FILE.

      *$PP-DEBUG							REALCICS
      P    EXEC CICS
      P        READ FILE('STF00001')
      P        INTO (WS-TIX-REC)
      P        RIDFLD (WS-TICKET-NUM1)
      P        RESP(WS-RES-CODE)
      P        EQUAL
      P    END-EXEC.
      *$PP-NOLIST							REALCICS
           MOVE 'SM03P' TO DFH-SOURCE-NAME                              REALCICS
	   MOVE 749 TO DFH-SOURCE-LINE-NUM				REALCICS
	   MOVE 001 TO DFH-FLAG (02)					REALCICS
           MOVE '8' TO DFH-DATA-TYPE (02)                               REALCICS
           MOVE '8 ' TO DFH-DATA-CLASS (02)                             REALCICS
           MOVE 'STF00001' TO DFH-DATA8 (02)                            REALCICS
	   SET DFH-ADDR (02) TO ADDRESS OF DFH-DATA8 (02)		REALCICS
	   ADD 0 LENGTH OF DFH-DATA8 (02) GIVING DFH-SIZE (02)		REALCICS
	   MOVE 001 TO DFH-FLAG (04)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (04)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (04)                              REALCICS
	   SET DFH-ADDR (04) TO ADDRESS OF WS-TIX-REC			REALCICS
	   ADD 0 LENGTH OF WS-TIX-REC GIVING DFH-SIZE (04)		REALCICS
	   MOVE 001 TO DFH-FLAG (06)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (06)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (06)                              REALCICS
	   SET DFH-ADDR (06) TO ADDRESS OF WS-TICKET-NUM1		REALCICS
	   ADD 0 LENGTH OF WS-TICKET-NUM1 GIVING DFH-SIZE (06)		REALCICS
	   MOVE 001 TO DFH-FLAG (01)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (01)                               REALCICS
           MOVE 'H ' TO DFH-DATA-CLASS (01)                             REALCICS
	   SET DFH-ADDR (01) TO ADDRESS OF WS-RES-CODE			REALCICS
	   ADD 0 LENGTH OF WS-RES-CODE GIVING DFH-SIZE (01)		REALCICS
	   MOVE 002 TO DFH-FLAG (11)					REALCICS
           MOVE '0' TO DFH-DATA-TYPE (11)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (11)                              REALCICS
           MOVE X'0602' TO DFH-COMMAND EIBFN                            REALCICS
	   MOVE 011 TO DFH-VARS-COUNT					REALCICS
           CALL 'CICS_Exec_Std' USING CICSICB GIVING DFH-RETURN-STATUS  REALCICS
           IF DFH-RETURN-STATUS = -1 CALL 'CICS_Link_Abend' USING       REALCICS
	       CICSICB END-IF						REALCICS
	   IF DFH-RETURN-STATUS < 0 STOP RUN				REALCICS
	   ELSE IF DFH-RETURN-STATUS > 0 PERFORM DFH-GOTO-HANDLE	REALCICS
	       END-IF END-IF						REALCICS
	   ADD 0 DFH-RESP GIVING WS-RES-CODE				REALCICS
	   .								REALCICS
      *$PP-LIST 							REALCICS

       800-CREATE-LOG.

	   MOVE WS-TICKET-NUM TO LOG-TIX-ID1
	   MOVE 1 TO LOG-SEQ-NUM
	   MOVE LOG-TIX-ID TO WS-LOG-PH
      *$PP-DEBUG							REALCICS
      P    EXEC CICS STARTBR FILE('stf00002')
      P 	RIDFLD (LOG-TIX-ID)
      P 	KEYLENGTH(+9)
      P 	RESP(WS-RES-CODE)
      P 	GTEQ
      P    END-EXEC
      *$PP-NOLIST							REALCICS
           MOVE 'SM03P' TO DFH-SOURCE-NAME                              REALCICS
	   MOVE 762 TO DFH-SOURCE-LINE-NUM				REALCICS
	   MOVE 001 TO DFH-FLAG (02)					REALCICS
           MOVE '8' TO DFH-DATA-TYPE (02)                               REALCICS
           MOVE '8 ' TO DFH-DATA-CLASS (02)                             REALCICS
           MOVE 'STF00002' TO DFH-DATA8 (02)                            REALCICS
	   SET DFH-ADDR (02) TO ADDRESS OF DFH-DATA8 (02)		REALCICS
	   ADD 0 LENGTH OF DFH-DATA8 (02) GIVING DFH-SIZE (02)		REALCICS
	   MOVE 001 TO DFH-FLAG (03)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (03)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (03)                              REALCICS
	   SET DFH-ADDR (03) TO ADDRESS OF LOG-TIX-ID			REALCICS
	   ADD 0 LENGTH OF LOG-TIX-ID GIVING DFH-SIZE (03)		REALCICS
	   MOVE 001 TO DFH-FLAG (04)					REALCICS
           MOVE '8' TO DFH-DATA-TYPE (04)                               REALCICS
           MOVE 'H ' TO DFH-DATA-CLASS (04)                             REALCICS
	   ADD 0 +9 GIVING DFH-DATAH (04)				REALCICS
	   SET DFH-ADDR (04) TO ADDRESS OF DFH-DATAH (04)		REALCICS
	   ADD 0 LENGTH OF DFH-DATAH (04) GIVING DFH-SIZE (04)		REALCICS
	   MOVE 001 TO DFH-FLAG (01)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (01)                               REALCICS
           MOVE 'H ' TO DFH-DATA-CLASS (01)                             REALCICS
	   SET DFH-ADDR (01) TO ADDRESS OF WS-RES-CODE			REALCICS
	   ADD 0 LENGTH OF WS-RES-CODE GIVING DFH-SIZE (01)		REALCICS
	   MOVE 001 TO DFH-FLAG (08)					REALCICS
           MOVE '0' TO DFH-DATA-TYPE (08)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (08)                              REALCICS
           MOVE X'060C' TO DFH-COMMAND EIBFN                            REALCICS
	   MOVE 008 TO DFH-VARS-COUNT					REALCICS
           CALL 'CICS_Exec_Std' USING CICSICB GIVING DFH-RETURN-STATUS  REALCICS
           IF DFH-RETURN-STATUS = -1 CALL 'CICS_Link_Abend' USING       REALCICS
	       CICSICB END-IF						REALCICS
	   IF DFH-RETURN-STATUS < 0 STOP RUN				REALCICS
	   ELSE IF DFH-RETURN-STATUS > 0 PERFORM DFH-GOTO-HANDLE	REALCICS
	       END-IF END-IF						REALCICS
	   ADD 0 DFH-RESP GIVING WS-RES-CODE				REALCICS
      *$PP-LIST 							REALCICS
	   PERFORM UNTIL LOG-TIX-ID1 NOT = WS-LOG-PH(1:6)
      *$PP-DEBUG							REALCICS
      P        EXEC CICS READPREV
      P                  FILE('stf00002')
      P 		 INTO (WS-LOG)
      P 		 RIDFLD (LOG-TIX-ID)
      P 		 RESP(WS-RES-CODE)
      P        END-EXEC
      *$PP-NOLIST							REALCICS
           MOVE 'SM03P' TO DFH-SOURCE-NAME                              REALCICS
	   MOVE 769 TO DFH-SOURCE-LINE-NUM				REALCICS
	   MOVE 001 TO DFH-FLAG (02)					REALCICS
           MOVE '8' TO DFH-DATA-TYPE (02)                               REALCICS
           MOVE '8 ' TO DFH-DATA-CLASS (02)                             REALCICS
           MOVE 'STF00002' TO DFH-DATA8 (02)                            REALCICS
	   SET DFH-ADDR (02) TO ADDRESS OF DFH-DATA8 (02)		REALCICS
	   ADD 0 LENGTH OF DFH-DATA8 (02) GIVING DFH-SIZE (02)		REALCICS
	   MOVE 001 TO DFH-FLAG (03)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (03)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (03)                              REALCICS
	   SET DFH-ADDR (03) TO ADDRESS OF WS-LOG			REALCICS
	   ADD 0 LENGTH OF WS-LOG GIVING DFH-SIZE (03)			REALCICS
	   MOVE 001 TO DFH-FLAG (05)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (05)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (05)                              REALCICS
	   SET DFH-ADDR (05) TO ADDRESS OF LOG-TIX-ID			REALCICS
	   ADD 0 LENGTH OF LOG-TIX-ID GIVING DFH-SIZE (05)		REALCICS
	   MOVE 001 TO DFH-FLAG (01)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (01)                               REALCICS
           MOVE 'H ' TO DFH-DATA-CLASS (01)                             REALCICS
	   SET DFH-ADDR (01) TO ADDRESS OF WS-RES-CODE			REALCICS
	   ADD 0 LENGTH OF WS-RES-CODE GIVING DFH-SIZE (01)		REALCICS
           MOVE X'0610' TO DFH-COMMAND EIBFN                            REALCICS
	   MOVE 005 TO DFH-VARS-COUNT					REALCICS
           CALL 'CICS_Exec_Std' USING CICSICB GIVING DFH-RETURN-STATUS  REALCICS
           IF DFH-RETURN-STATUS = -1 CALL 'CICS_Link_Abend' USING       REALCICS
	       CICSICB END-IF						REALCICS
	   IF DFH-RETURN-STATUS < 0 STOP RUN				REALCICS
	   ELSE IF DFH-RETURN-STATUS > 0 PERFORM DFH-GOTO-HANDLE	REALCICS
	       END-IF END-IF						REALCICS
	   ADD 0 DFH-RESP GIVING WS-RES-CODE				REALCICS
      *$PP-LIST 							REALCICS
	       IF WS-LOG-PH(1:6) NOT = LOG-TIX-ID1
		   CONTINUE
	       ELSE
		   MOVE LOG-TIX-ID TO WS-LOG-PH
	       END-IF
	       ADD 1 TO LOG-SEQ-NUM
	   END-PERFORM
      *$PP-DEBUG							REALCICS
      P    EXEC CICS ENDBR
      P         FILE('stF00002')
      P    END-EXEC
      *$PP-NOLIST							REALCICS
           MOVE 'SM03P' TO DFH-SOURCE-NAME                              REALCICS
	   MOVE 782 TO DFH-SOURCE-LINE-NUM				REALCICS
	   MOVE 001 TO DFH-FLAG (02)					REALCICS
           MOVE '8' TO DFH-DATA-TYPE (02)                               REALCICS
           MOVE '8 ' TO DFH-DATA-CLASS (02)                             REALCICS
           MOVE 'STF00002' TO DFH-DATA8 (02)                            REALCICS
	   SET DFH-ADDR (02) TO ADDRESS OF DFH-DATA8 (02)		REALCICS
	   ADD 0 LENGTH OF DFH-DATA8 (02) GIVING DFH-SIZE (02)		REALCICS
           MOVE X'0612' TO DFH-COMMAND EIBFN                            REALCICS
	   MOVE 002 TO DFH-VARS-COUNT					REALCICS
           CALL 'CICS_Exec_Std' USING CICSICB GIVING DFH-RETURN-STATUS  REALCICS
           IF DFH-RETURN-STATUS = -1 CALL 'CICS_Link_Abend' USING       REALCICS
	       CICSICB END-IF						REALCICS
	   IF DFH-RETURN-STATUS < 0 STOP RUN				REALCICS
	   ELSE IF DFH-RETURN-STATUS > 0 PERFORM DFH-GOTO-HANDLE	REALCICS
	       END-IF END-IF						REALCICS
      *$PP-LIST 							REALCICS

	   MOVE WS-TICKET-NUM1 TO TIXNUMO

	   IF TIXTTLO = LOW-VALUES
	    MOVE WS-TCKTTL TO TIXTTLO
	   END-IF

	   IF TIXDESC1O = LOW-VALUES
	    MOVE WS-TCKDESC(1:50) TO TIXDESC1O
	   END-IF

	   IF TIXDESC2O = LOW-VALUES
	    MOVE WS-TCKDESC(51:50) TO TIXDESC2O
	   END-IF

	   IF (TIXTTLO NOT = TIX-TITLE
	   AND TIXDESC1O NOT = TIX-DESC1)
	   OR (TIXTTLO NOT = TIX-TITLE
	   AND TIXDESC2O NOT = TIX-DESC2)
           AND (STATO = 'COMPLETED')

	    ADD 1 TO WS-LOG-SEQ
	    MOVE WS-LOG-PH TO LOG-TIX-ID
	    MOVE WS-HDATE-X TO LOG-LAST-UPDATE-DATE
	    MOVE WS-HTIME-X TO LOG-LAST-UPDATE-TIME
	    MOVE WS-USERID1 TO LOG-UPDBY2
            MOVE 'COMPLETED. TITLE/DESCRIPTION UPDATED'
	    TO LOG-LAST-UPDATE-REM

      *$PP-DEBUG							REALCICS
      P      EXEC CICS
      P        WRITE FILE('stf00002')
      P        FROM(WS-LOG)
      P        RIDFLD(LOG-TIX-ID)
      P        RESP(WS-RES-CODE)
      P     END-EXEC
      *$PP-NOLIST							REALCICS
           MOVE 'SM03P' TO DFH-SOURCE-NAME                              REALCICS
	   MOVE 814 TO DFH-SOURCE-LINE-NUM				REALCICS
	   MOVE 001 TO DFH-FLAG (02)					REALCICS
           MOVE '8' TO DFH-DATA-TYPE (02)                               REALCICS
           MOVE '8 ' TO DFH-DATA-CLASS (02)                             REALCICS
           MOVE 'STF00002' TO DFH-DATA8 (02)                            REALCICS
	   SET DFH-ADDR (02) TO ADDRESS OF DFH-DATA8 (02)		REALCICS
	   ADD 0 LENGTH OF DFH-DATA8 (02) GIVING DFH-SIZE (02)		REALCICS
	   MOVE 001 TO DFH-FLAG (04)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (04)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (04)                              REALCICS
	   SET DFH-ADDR (04) TO ADDRESS OF WS-LOG			REALCICS
	   ADD 0 LENGTH OF WS-LOG GIVING DFH-SIZE (04)			REALCICS
	   MOVE 001 TO DFH-FLAG (06)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (06)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (06)                              REALCICS
	   SET DFH-ADDR (06) TO ADDRESS OF LOG-TIX-ID			REALCICS
	   ADD 0 LENGTH OF LOG-TIX-ID GIVING DFH-SIZE (06)		REALCICS
	   MOVE 001 TO DFH-FLAG (01)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (01)                               REALCICS
           MOVE 'H ' TO DFH-DATA-CLASS (01)                             REALCICS
	   SET DFH-ADDR (01) TO ADDRESS OF WS-RES-CODE			REALCICS
	   ADD 0 LENGTH OF WS-RES-CODE GIVING DFH-SIZE (01)		REALCICS
           MOVE X'0604' TO DFH-COMMAND EIBFN                            REALCICS
	   MOVE 006 TO DFH-VARS-COUNT					REALCICS
           CALL 'CICS_Exec_Std' USING CICSICB GIVING DFH-RETURN-STATUS  REALCICS
           IF DFH-RETURN-STATUS = -1 CALL 'CICS_Link_Abend' USING       REALCICS
	       CICSICB END-IF						REALCICS
	   IF DFH-RETURN-STATUS < 0 STOP RUN				REALCICS
	   ELSE IF DFH-RETURN-STATUS > 0 PERFORM DFH-GOTO-HANDLE	REALCICS
	       END-IF END-IF						REALCICS
	   ADD 0 DFH-RESP GIVING WS-RES-CODE				REALCICS
      *$PP-LIST 							REALCICS

	   ELSE IF (TIXTTLO NOT = TIX-TITLE
	   AND TIXDESC1O NOT = TIX-DESC1)
	   OR (TIXTTLO NOT = TIX-TITLE
	   AND TIXDESC2O NOT = TIX-DESC2)

	    ADD 1 TO WS-LOG-SEQ
	    MOVE WS-LOG-PH TO LOG-TIX-ID
	    MOVE WS-HDATE-X TO LOG-LAST-UPDATE-DATE
	    MOVE WS-HTIME-X TO LOG-LAST-UPDATE-TIME
	    MOVE WS-USERID1 TO LOG-UPDBY2
            MOVE 'TITLE/DESCRIPTION UPDATED'
	    TO LOG-LAST-UPDATE-REM

      *$PP-DEBUG							REALCICS
      P      EXEC CICS
      P        WRITE FILE('stf00002')
      P        FROM(WS-LOG)
      P        RIDFLD(LOG-TIX-ID)
      P        RESP(WS-RES-CODE)
      P     END-EXEC
      *$PP-NOLIST							REALCICS
           MOVE 'SM03P' TO DFH-SOURCE-NAME                              REALCICS
	   MOVE 834 TO DFH-SOURCE-LINE-NUM				REALCICS
	   MOVE 001 TO DFH-FLAG (02)					REALCICS
           MOVE '8' TO DFH-DATA-TYPE (02)                               REALCICS
           MOVE '8 ' TO DFH-DATA-CLASS (02)                             REALCICS
           MOVE 'STF00002' TO DFH-DATA8 (02)                            REALCICS
	   SET DFH-ADDR (02) TO ADDRESS OF DFH-DATA8 (02)		REALCICS
	   ADD 0 LENGTH OF DFH-DATA8 (02) GIVING DFH-SIZE (02)		REALCICS
	   MOVE 001 TO DFH-FLAG (04)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (04)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (04)                              REALCICS
	   SET DFH-ADDR (04) TO ADDRESS OF WS-LOG			REALCICS
	   ADD 0 LENGTH OF WS-LOG GIVING DFH-SIZE (04)			REALCICS
	   MOVE 001 TO DFH-FLAG (06)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (06)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (06)                              REALCICS
	   SET DFH-ADDR (06) TO ADDRESS OF LOG-TIX-ID			REALCICS
	   ADD 0 LENGTH OF LOG-TIX-ID GIVING DFH-SIZE (06)		REALCICS
	   MOVE 001 TO DFH-FLAG (01)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (01)                               REALCICS
           MOVE 'H ' TO DFH-DATA-CLASS (01)                             REALCICS
	   SET DFH-ADDR (01) TO ADDRESS OF WS-RES-CODE			REALCICS
	   ADD 0 LENGTH OF WS-RES-CODE GIVING DFH-SIZE (01)		REALCICS
           MOVE X'0604' TO DFH-COMMAND EIBFN                            REALCICS
	   MOVE 006 TO DFH-VARS-COUNT					REALCICS
           CALL 'CICS_Exec_Std' USING CICSICB GIVING DFH-RETURN-STATUS  REALCICS
           IF DFH-RETURN-STATUS = -1 CALL 'CICS_Link_Abend' USING       REALCICS
	       CICSICB END-IF						REALCICS
	   IF DFH-RETURN-STATUS < 0 STOP RUN				REALCICS
	   ELSE IF DFH-RETURN-STATUS > 0 PERFORM DFH-GOTO-HANDLE	REALCICS
	       END-IF END-IF						REALCICS
	   ADD 0 DFH-RESP GIVING WS-RES-CODE				REALCICS
      *$PP-LIST 							REALCICS

	   ELSE IF (TIXTTLO NOT = TIX-TITLE
	   AND TIXDESC1O = TIX-DESC1)
	   OR (TIXTTLO NOT = TIX-TITLE
	   AND TIXDESC2O = TIX-DESC2)
           AND (STATO = 'COMPLETED')

	    ADD 1 TO WS-LOG-SEQ
	    MOVE WS-LOG-PH TO LOG-TIX-ID
	    MOVE WS-HDATE-X TO LOG-LAST-UPDATE-DATE
	    MOVE WS-HTIME-X TO LOG-LAST-UPDATE-TIME
	    MOVE WS-USERID1 TO LOG-UPDBY2
            MOVE 'COMPLETED. TICKET TITLE UPDATED'
	    TO LOG-LAST-UPDATE-REM

      *$PP-DEBUG							REALCICS
      P      EXEC CICS
      P        WRITE FILE('stf00002')
      P        FROM(WS-LOG)
      P        RIDFLD(LOG-TIX-ID)
      P        RESP(WS-RES-CODE)
      P     END-EXEC
      *$PP-NOLIST							REALCICS
           MOVE 'SM03P' TO DFH-SOURCE-NAME                              REALCICS
	   MOVE 855 TO DFH-SOURCE-LINE-NUM				REALCICS
	   MOVE 001 TO DFH-FLAG (02)					REALCICS
           MOVE '8' TO DFH-DATA-TYPE (02)                               REALCICS
           MOVE '8 ' TO DFH-DATA-CLASS (02)                             REALCICS
           MOVE 'STF00002' TO DFH-DATA8 (02)                            REALCICS
	   SET DFH-ADDR (02) TO ADDRESS OF DFH-DATA8 (02)		REALCICS
	   ADD 0 LENGTH OF DFH-DATA8 (02) GIVING DFH-SIZE (02)		REALCICS
	   MOVE 001 TO DFH-FLAG (04)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (04)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (04)                              REALCICS
	   SET DFH-ADDR (04) TO ADDRESS OF WS-LOG			REALCICS
	   ADD 0 LENGTH OF WS-LOG GIVING DFH-SIZE (04)			REALCICS
	   MOVE 001 TO DFH-FLAG (06)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (06)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (06)                              REALCICS
	   SET DFH-ADDR (06) TO ADDRESS OF LOG-TIX-ID			REALCICS
	   ADD 0 LENGTH OF LOG-TIX-ID GIVING DFH-SIZE (06)		REALCICS
	   MOVE 001 TO DFH-FLAG (01)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (01)                               REALCICS
           MOVE 'H ' TO DFH-DATA-CLASS (01)                             REALCICS
	   SET DFH-ADDR (01) TO ADDRESS OF WS-RES-CODE			REALCICS
	   ADD 0 LENGTH OF WS-RES-CODE GIVING DFH-SIZE (01)		REALCICS
           MOVE X'0604' TO DFH-COMMAND EIBFN                            REALCICS
	   MOVE 006 TO DFH-VARS-COUNT					REALCICS
           CALL 'CICS_Exec_Std' USING CICSICB GIVING DFH-RETURN-STATUS  REALCICS
           IF DFH-RETURN-STATUS = -1 CALL 'CICS_Link_Abend' USING       REALCICS
	       CICSICB END-IF						REALCICS
	   IF DFH-RETURN-STATUS < 0 STOP RUN				REALCICS
	   ELSE IF DFH-RETURN-STATUS > 0 PERFORM DFH-GOTO-HANDLE	REALCICS
	       END-IF END-IF						REALCICS
	   ADD 0 DFH-RESP GIVING WS-RES-CODE				REALCICS
      *$PP-LIST 							REALCICS


	   ELSE IF (TIXTTLO NOT = TIX-TITLE
	   AND TIXDESC1O = TIX-DESC1)
	   OR (TIXTTLO NOT = TIX-TITLE
	   AND TIXDESC2O = TIX-DESC2)

	    ADD 1 TO WS-LOG-SEQ
	    MOVE WS-LOG-PH TO LOG-TIX-ID
	    MOVE WS-HDATE-X TO LOG-LAST-UPDATE-DATE
	    MOVE WS-HTIME-X TO LOG-LAST-UPDATE-TIME
	    MOVE WS-USERID1 TO LOG-UPDBY2
            MOVE 'TICKET TITLE UPDATED'
	    TO LOG-LAST-UPDATE-REM

      *$PP-DEBUG							REALCICS
      P    EXEC CICS
      P        WRITE FILE('stf00002')
      P        FROM(WS-LOG)
      P        RIDFLD(LOG-TIX-ID)
      P        RESP(WS-RES-CODE)
      P    END-EXEC
      *$PP-NOLIST							REALCICS
           MOVE 'SM03P' TO DFH-SOURCE-NAME                              REALCICS
	   MOVE 876 TO DFH-SOURCE-LINE-NUM				REALCICS
	   MOVE 001 TO DFH-FLAG (02)					REALCICS
           MOVE '8' TO DFH-DATA-TYPE (02)                               REALCICS
           MOVE '8 ' TO DFH-DATA-CLASS (02)                             REALCICS
           MOVE 'STF00002' TO DFH-DATA8 (02)                            REALCICS
	   SET DFH-ADDR (02) TO ADDRESS OF DFH-DATA8 (02)		REALCICS
	   ADD 0 LENGTH OF DFH-DATA8 (02) GIVING DFH-SIZE (02)		REALCICS
	   MOVE 001 TO DFH-FLAG (04)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (04)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (04)                              REALCICS
	   SET DFH-ADDR (04) TO ADDRESS OF WS-LOG			REALCICS
	   ADD 0 LENGTH OF WS-LOG GIVING DFH-SIZE (04)			REALCICS
	   MOVE 001 TO DFH-FLAG (06)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (06)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (06)                              REALCICS
	   SET DFH-ADDR (06) TO ADDRESS OF LOG-TIX-ID			REALCICS
	   ADD 0 LENGTH OF LOG-TIX-ID GIVING DFH-SIZE (06)		REALCICS
	   MOVE 001 TO DFH-FLAG (01)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (01)                               REALCICS
           MOVE 'H ' TO DFH-DATA-CLASS (01)                             REALCICS
	   SET DFH-ADDR (01) TO ADDRESS OF WS-RES-CODE			REALCICS
	   ADD 0 LENGTH OF WS-RES-CODE GIVING DFH-SIZE (01)		REALCICS
           MOVE X'0604' TO DFH-COMMAND EIBFN                            REALCICS
	   MOVE 006 TO DFH-VARS-COUNT					REALCICS
           CALL 'CICS_Exec_Std' USING CICSICB GIVING DFH-RETURN-STATUS  REALCICS
           IF DFH-RETURN-STATUS = -1 CALL 'CICS_Link_Abend' USING       REALCICS
	       CICSICB END-IF						REALCICS
	   IF DFH-RETURN-STATUS < 0 STOP RUN				REALCICS
	   ELSE IF DFH-RETURN-STATUS > 0 PERFORM DFH-GOTO-HANDLE	REALCICS
	       END-IF END-IF						REALCICS
	   ADD 0 DFH-RESP GIVING WS-RES-CODE				REALCICS
      *$PP-LIST 							REALCICS

	   ELSE IF (TIXTTLO = TIX-TITLE
	   AND TIXDESC1O NOT = TIX-DESC1)
	   OR (TIXTTLO = TIX-TITLE
	   AND TIXDESC2O NOT = TIX-DESC2)
           AND (STATO = 'COMPLETED')

	    ADD 1 TO WS-LOG-SEQ
	    MOVE WS-LOG-PH TO LOG-TIX-ID
	    MOVE WS-HDATE-X TO LOG-LAST-UPDATE-DATE
	    MOVE WS-HTIME-X TO LOG-LAST-UPDATE-TIME
	    MOVE WS-USERID1 TO LOG-UPDBY2
            MOVE 'COMPLETED. TICKET DESCRIPTION UPDATED'
	    TO LOG-LAST-UPDATE-REM

      *$PP-DEBUG							REALCICS
      P    EXEC CICS
      P        WRITE FILE('stf00002')
      P        FROM(WS-LOG)
      P        RIDFLD(LOG-TIX-ID)
      P        RESP(WS-RES-CODE)
      P    END-EXEC
      *$PP-NOLIST							REALCICS
           MOVE 'SM03P' TO DFH-SOURCE-NAME                              REALCICS
	   MOVE 897 TO DFH-SOURCE-LINE-NUM				REALCICS
	   MOVE 001 TO DFH-FLAG (02)					REALCICS
           MOVE '8' TO DFH-DATA-TYPE (02)                               REALCICS
           MOVE '8 ' TO DFH-DATA-CLASS (02)                             REALCICS
           MOVE 'STF00002' TO DFH-DATA8 (02)                            REALCICS
	   SET DFH-ADDR (02) TO ADDRESS OF DFH-DATA8 (02)		REALCICS
	   ADD 0 LENGTH OF DFH-DATA8 (02) GIVING DFH-SIZE (02)		REALCICS
	   MOVE 001 TO DFH-FLAG (04)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (04)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (04)                              REALCICS
	   SET DFH-ADDR (04) TO ADDRESS OF WS-LOG			REALCICS
	   ADD 0 LENGTH OF WS-LOG GIVING DFH-SIZE (04)			REALCICS
	   MOVE 001 TO DFH-FLAG (06)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (06)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (06)                              REALCICS
	   SET DFH-ADDR (06) TO ADDRESS OF LOG-TIX-ID			REALCICS
	   ADD 0 LENGTH OF LOG-TIX-ID GIVING DFH-SIZE (06)		REALCICS
	   MOVE 001 TO DFH-FLAG (01)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (01)                               REALCICS
           MOVE 'H ' TO DFH-DATA-CLASS (01)                             REALCICS
	   SET DFH-ADDR (01) TO ADDRESS OF WS-RES-CODE			REALCICS
	   ADD 0 LENGTH OF WS-RES-CODE GIVING DFH-SIZE (01)		REALCICS
           MOVE X'0604' TO DFH-COMMAND EIBFN                            REALCICS
	   MOVE 006 TO DFH-VARS-COUNT					REALCICS
           CALL 'CICS_Exec_Std' USING CICSICB GIVING DFH-RETURN-STATUS  REALCICS
           IF DFH-RETURN-STATUS = -1 CALL 'CICS_Link_Abend' USING       REALCICS
	       CICSICB END-IF						REALCICS
	   IF DFH-RETURN-STATUS < 0 STOP RUN				REALCICS
	   ELSE IF DFH-RETURN-STATUS > 0 PERFORM DFH-GOTO-HANDLE	REALCICS
	       END-IF END-IF						REALCICS
	   ADD 0 DFH-RESP GIVING WS-RES-CODE				REALCICS
      *$PP-LIST 							REALCICS

	   ELSE IF (TIXTTLO = TIX-TITLE
	   AND TIXDESC1O NOT = TIX-DESC1)
	   OR (TIXTTLO = TIX-TITLE
	   AND TIXDESC2O NOT = TIX-DESC2)

	    ADD 1 TO WS-LOG-SEQ
	    MOVE WS-LOG-PH TO LOG-TIX-ID
	    MOVE WS-HDATE-X TO LOG-LAST-UPDATE-DATE
	    MOVE WS-HTIME-X TO LOG-LAST-UPDATE-TIME
	    MOVE WS-USERID1 TO LOG-UPDBY2
            MOVE 'TICKET DESCRIPTION UPDATED'
	    TO LOG-LAST-UPDATE-REM

      *$PP-DEBUG							REALCICS
      P     EXEC CICS
      P        WRITE FILE('stf00002')
      P        FROM(WS-LOG)
      P        RIDFLD(LOG-TIX-ID)
      P        RESP(WS-RES-CODE)
      P    END-EXEC
      *$PP-NOLIST							REALCICS
           MOVE 'SM03P' TO DFH-SOURCE-NAME                              REALCICS
	   MOVE 917 TO DFH-SOURCE-LINE-NUM				REALCICS
	   MOVE 001 TO DFH-FLAG (02)					REALCICS
           MOVE '8' TO DFH-DATA-TYPE (02)                               REALCICS
           MOVE '8 ' TO DFH-DATA-CLASS (02)                             REALCICS
           MOVE 'STF00002' TO DFH-DATA8 (02)                            REALCICS
	   SET DFH-ADDR (02) TO ADDRESS OF DFH-DATA8 (02)		REALCICS
	   ADD 0 LENGTH OF DFH-DATA8 (02) GIVING DFH-SIZE (02)		REALCICS
	   MOVE 001 TO DFH-FLAG (04)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (04)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (04)                              REALCICS
	   SET DFH-ADDR (04) TO ADDRESS OF WS-LOG			REALCICS
	   ADD 0 LENGTH OF WS-LOG GIVING DFH-SIZE (04)			REALCICS
	   MOVE 001 TO DFH-FLAG (06)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (06)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (06)                              REALCICS
	   SET DFH-ADDR (06) TO ADDRESS OF LOG-TIX-ID			REALCICS
	   ADD 0 LENGTH OF LOG-TIX-ID GIVING DFH-SIZE (06)		REALCICS
	   MOVE 001 TO DFH-FLAG (01)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (01)                               REALCICS
           MOVE 'H ' TO DFH-DATA-CLASS (01)                             REALCICS
	   SET DFH-ADDR (01) TO ADDRESS OF WS-RES-CODE			REALCICS
	   ADD 0 LENGTH OF WS-RES-CODE GIVING DFH-SIZE (01)		REALCICS
           MOVE X'0604' TO DFH-COMMAND EIBFN                            REALCICS
	   MOVE 006 TO DFH-VARS-COUNT					REALCICS
           CALL 'CICS_Exec_Std' USING CICSICB GIVING DFH-RETURN-STATUS  REALCICS
           IF DFH-RETURN-STATUS = -1 CALL 'CICS_Link_Abend' USING       REALCICS
	       CICSICB END-IF						REALCICS
	   IF DFH-RETURN-STATUS < 0 STOP RUN				REALCICS
	   ELSE IF DFH-RETURN-STATUS > 0 PERFORM DFH-GOTO-HANDLE	REALCICS
	       END-IF END-IF						REALCICS
	   ADD 0 DFH-RESP GIVING WS-RES-CODE				REALCICS
      *$PP-LIST 							REALCICS

	   ELSE IF (TIXTTLO = TIX-TITLE
	   AND TIXDESC1O = TIX-DESC1)
	   OR (TIXTTLO = TIX-TITLE
	   AND TIXDESC2O = TIX-DESC2)
           AND (STATO = 'COMPLETED')

	    ADD 1 TO WS-LOG-SEQ
	    MOVE WS-LOG-PH TO LOG-TIX-ID
	    MOVE WS-HDATE-X TO LOG-LAST-UPDATE-DATE
	    MOVE WS-HTIME-X TO LOG-LAST-UPDATE-TIME
	    MOVE WS-USERID1 TO LOG-UPDBY2
            MOVE 'COMPLETED. TICKET STATUS UPDATED'
	    TO LOG-LAST-UPDATE-REM

      *$PP-DEBUG							REALCICS
      P    EXEC CICS
      P        WRITE FILE('stf00002')
      P        FROM(WS-LOG)
      P        RIDFLD(LOG-TIX-ID)
      P        RESP(WS-RES-CODE)
      P    END-EXEC
      *$PP-NOLIST							REALCICS
           MOVE 'SM03P' TO DFH-SOURCE-NAME                              REALCICS
	   MOVE 938 TO DFH-SOURCE-LINE-NUM				REALCICS
	   MOVE 001 TO DFH-FLAG (02)					REALCICS
           MOVE '8' TO DFH-DATA-TYPE (02)                               REALCICS
           MOVE '8 ' TO DFH-DATA-CLASS (02)                             REALCICS
           MOVE 'STF00002' TO DFH-DATA8 (02)                            REALCICS
	   SET DFH-ADDR (02) TO ADDRESS OF DFH-DATA8 (02)		REALCICS
	   ADD 0 LENGTH OF DFH-DATA8 (02) GIVING DFH-SIZE (02)		REALCICS
	   MOVE 001 TO DFH-FLAG (04)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (04)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (04)                              REALCICS
	   SET DFH-ADDR (04) TO ADDRESS OF WS-LOG			REALCICS
	   ADD 0 LENGTH OF WS-LOG GIVING DFH-SIZE (04)			REALCICS
	   MOVE 001 TO DFH-FLAG (06)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (06)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (06)                              REALCICS
	   SET DFH-ADDR (06) TO ADDRESS OF LOG-TIX-ID			REALCICS
	   ADD 0 LENGTH OF LOG-TIX-ID GIVING DFH-SIZE (06)		REALCICS
	   MOVE 001 TO DFH-FLAG (01)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (01)                               REALCICS
           MOVE 'H ' TO DFH-DATA-CLASS (01)                             REALCICS
	   SET DFH-ADDR (01) TO ADDRESS OF WS-RES-CODE			REALCICS
	   ADD 0 LENGTH OF WS-RES-CODE GIVING DFH-SIZE (01)		REALCICS
           MOVE X'0604' TO DFH-COMMAND EIBFN                            REALCICS
	   MOVE 006 TO DFH-VARS-COUNT					REALCICS
           CALL 'CICS_Exec_Std' USING CICSICB GIVING DFH-RETURN-STATUS  REALCICS
           IF DFH-RETURN-STATUS = -1 CALL 'CICS_Link_Abend' USING       REALCICS
	       CICSICB END-IF						REALCICS
	   IF DFH-RETURN-STATUS < 0 STOP RUN				REALCICS
	   ELSE IF DFH-RETURN-STATUS > 0 PERFORM DFH-GOTO-HANDLE	REALCICS
	       END-IF END-IF						REALCICS
	   ADD 0 DFH-RESP GIVING WS-RES-CODE				REALCICS
      *$PP-LIST 							REALCICS

	   END-IF.


       900-CREATE-LOG-2.

	   MOVE WS-TICKET-NUM TO LOG-TIX-ID1
	   MOVE 1 TO LOG-SEQ-NUM
	   MOVE LOG-TIX-ID TO WS-LOG-PH
      *$PP-DEBUG							REALCICS
      P    EXEC CICS STARTBR FILE('stf00002')
      P 	RIDFLD (LOG-TIX-ID)
      P 	KEYLENGTH(+9)
      P 	RESP(WS-RES-CODE)
      P 	GTEQ
      P    END-EXEC
      *$PP-NOLIST							REALCICS
           MOVE 'SM03P' TO DFH-SOURCE-NAME                              REALCICS
	   MOVE 953 TO DFH-SOURCE-LINE-NUM				REALCICS
	   MOVE 001 TO DFH-FLAG (02)					REALCICS
           MOVE '8' TO DFH-DATA-TYPE (02)                               REALCICS
           MOVE '8 ' TO DFH-DATA-CLASS (02)                             REALCICS
           MOVE 'STF00002' TO DFH-DATA8 (02)                            REALCICS
	   SET DFH-ADDR (02) TO ADDRESS OF DFH-DATA8 (02)		REALCICS
	   ADD 0 LENGTH OF DFH-DATA8 (02) GIVING DFH-SIZE (02)		REALCICS
	   MOVE 001 TO DFH-FLAG (03)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (03)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (03)                              REALCICS
	   SET DFH-ADDR (03) TO ADDRESS OF LOG-TIX-ID			REALCICS
	   ADD 0 LENGTH OF LOG-TIX-ID GIVING DFH-SIZE (03)		REALCICS
	   MOVE 001 TO DFH-FLAG (04)					REALCICS
           MOVE '8' TO DFH-DATA-TYPE (04)                               REALCICS
           MOVE 'H ' TO DFH-DATA-CLASS (04)                             REALCICS
	   ADD 0 +9 GIVING DFH-DATAH (04)				REALCICS
	   SET DFH-ADDR (04) TO ADDRESS OF DFH-DATAH (04)		REALCICS
	   ADD 0 LENGTH OF DFH-DATAH (04) GIVING DFH-SIZE (04)		REALCICS
	   MOVE 001 TO DFH-FLAG (01)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (01)                               REALCICS
           MOVE 'H ' TO DFH-DATA-CLASS (01)                             REALCICS
	   SET DFH-ADDR (01) TO ADDRESS OF WS-RES-CODE			REALCICS
	   ADD 0 LENGTH OF WS-RES-CODE GIVING DFH-SIZE (01)		REALCICS
	   MOVE 001 TO DFH-FLAG (08)					REALCICS
           MOVE '0' TO DFH-DATA-TYPE (08)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (08)                              REALCICS
           MOVE X'060C' TO DFH-COMMAND EIBFN                            REALCICS
	   MOVE 008 TO DFH-VARS-COUNT					REALCICS
           CALL 'CICS_Exec_Std' USING CICSICB GIVING DFH-RETURN-STATUS  REALCICS
           IF DFH-RETURN-STATUS = -1 CALL 'CICS_Link_Abend' USING       REALCICS
	       CICSICB END-IF						REALCICS
	   IF DFH-RETURN-STATUS < 0 STOP RUN				REALCICS
	   ELSE IF DFH-RETURN-STATUS > 0 PERFORM DFH-GOTO-HANDLE	REALCICS
	       END-IF END-IF						REALCICS
	   ADD 0 DFH-RESP GIVING WS-RES-CODE				REALCICS
      *$PP-LIST 							REALCICS
	   PERFORM UNTIL LOG-TIX-ID1 NOT = WS-LOG-PH(1:6)
      *$PP-DEBUG							REALCICS
      P        EXEC CICS READPREV
      P                  FILE('stf00002')
      P 		 INTO (WS-LOG)
      P 		 RIDFLD (LOG-TIX-ID)
      P 		 RESP(WS-RES-CODE)
      P        END-EXEC
      *$PP-NOLIST							REALCICS
           MOVE 'SM03P' TO DFH-SOURCE-NAME                              REALCICS
	   MOVE 960 TO DFH-SOURCE-LINE-NUM				REALCICS
	   MOVE 001 TO DFH-FLAG (02)					REALCICS
           MOVE '8' TO DFH-DATA-TYPE (02)                               REALCICS
           MOVE '8 ' TO DFH-DATA-CLASS (02)                             REALCICS
           MOVE 'STF00002' TO DFH-DATA8 (02)                            REALCICS
	   SET DFH-ADDR (02) TO ADDRESS OF DFH-DATA8 (02)		REALCICS
	   ADD 0 LENGTH OF DFH-DATA8 (02) GIVING DFH-SIZE (02)		REALCICS
	   MOVE 001 TO DFH-FLAG (03)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (03)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (03)                              REALCICS
	   SET DFH-ADDR (03) TO ADDRESS OF WS-LOG			REALCICS
	   ADD 0 LENGTH OF WS-LOG GIVING DFH-SIZE (03)			REALCICS
	   MOVE 001 TO DFH-FLAG (05)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (05)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (05)                              REALCICS
	   SET DFH-ADDR (05) TO ADDRESS OF LOG-TIX-ID			REALCICS
	   ADD 0 LENGTH OF LOG-TIX-ID GIVING DFH-SIZE (05)		REALCICS
	   MOVE 001 TO DFH-FLAG (01)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (01)                               REALCICS
           MOVE 'H ' TO DFH-DATA-CLASS (01)                             REALCICS
	   SET DFH-ADDR (01) TO ADDRESS OF WS-RES-CODE			REALCICS
	   ADD 0 LENGTH OF WS-RES-CODE GIVING DFH-SIZE (01)		REALCICS
           MOVE X'0610' TO DFH-COMMAND EIBFN                            REALCICS
	   MOVE 005 TO DFH-VARS-COUNT					REALCICS
           CALL 'CICS_Exec_Std' USING CICSICB GIVING DFH-RETURN-STATUS  REALCICS
           IF DFH-RETURN-STATUS = -1 CALL 'CICS_Link_Abend' USING       REALCICS
	       CICSICB END-IF						REALCICS
	   IF DFH-RETURN-STATUS < 0 STOP RUN				REALCICS
	   ELSE IF DFH-RETURN-STATUS > 0 PERFORM DFH-GOTO-HANDLE	REALCICS
	       END-IF END-IF						REALCICS
	   ADD 0 DFH-RESP GIVING WS-RES-CODE				REALCICS
      *$PP-LIST 							REALCICS
	       IF WS-LOG-PH(1:6) NOT = LOG-TIX-ID1
		   CONTINUE
	       ELSE
		   MOVE LOG-TIX-ID TO WS-LOG-PH
	       END-IF
	       ADD 1 TO LOG-SEQ-NUM
	   END-PERFORM
      *$PP-DEBUG							REALCICS
      P    EXEC CICS ENDBR
      P         FILE('stF00002')
      P    END-EXEC
      *$PP-NOLIST							REALCICS
           MOVE 'SM03P' TO DFH-SOURCE-NAME                              REALCICS
	   MOVE 973 TO DFH-SOURCE-LINE-NUM				REALCICS
	   MOVE 001 TO DFH-FLAG (02)					REALCICS
           MOVE '8' TO DFH-DATA-TYPE (02)                               REALCICS
           MOVE '8 ' TO DFH-DATA-CLASS (02)                             REALCICS
           MOVE 'STF00002' TO DFH-DATA8 (02)                            REALCICS
	   SET DFH-ADDR (02) TO ADDRESS OF DFH-DATA8 (02)		REALCICS
	   ADD 0 LENGTH OF DFH-DATA8 (02) GIVING DFH-SIZE (02)		REALCICS
           MOVE X'0612' TO DFH-COMMAND EIBFN                            REALCICS
	   MOVE 002 TO DFH-VARS-COUNT					REALCICS
           CALL 'CICS_Exec_Std' USING CICSICB GIVING DFH-RETURN-STATUS  REALCICS
           IF DFH-RETURN-STATUS = -1 CALL 'CICS_Link_Abend' USING       REALCICS
	       CICSICB END-IF						REALCICS
	   IF DFH-RETURN-STATUS < 0 STOP RUN				REALCICS
	   ELSE IF DFH-RETURN-STATUS > 0 PERFORM DFH-GOTO-HANDLE	REALCICS
	       END-IF END-IF						REALCICS
      *$PP-LIST 							REALCICS


	   MOVE WS-TICKET-NUM1 TO TIXNUMO

	   IF TIXTTLO = LOW-VALUES
	    MOVE WS-TCKTTL TO TIXTTLO
	   END-IF

	   IF TIXDESC1O = LOW-VALUES
	    MOVE WS-TCKDESC(1:50) TO TIXDESC1O
	   END-IF

	   IF TIXDESC2O = LOW-VALUES
	    MOVE WS-TCKDESC(51:50) TO TIXDESC2O
	   END-IF

	    ADD 1 TO WS-LOG-SEQ
	    MOVE WS-LOG-PH TO LOG-TIX-ID
	    MOVE WS-HDATE-X TO LOG-LAST-UPDATE-DATE
	    MOVE WS-HTIME-X TO LOG-LAST-UPDATE-TIME
	    MOVE WS-USERID1 TO LOG-UPDBY2
	    MOVE LAST-UPDATE-REM1 TO LOG-LAST-UPDATE-REM(1:25)
	    MOVE LAST-UPDATE-REM2 TO LOG-LAST-UPDATE-REM(26:25)

      *$PP-DEBUG							REALCICS
      P    EXEC CICS
      P        WRITE FILE('stf00002')
      P        FROM(WS-LOG)
      P        RIDFLD(LOG-TIX-ID)
      P        RESP(WS-RES-CODE)
      P    END-EXEC.
      *$PP-NOLIST							REALCICS
           MOVE 'SM03P' TO DFH-SOURCE-NAME                              REALCICS
	   MOVE 1000 TO DFH-SOURCE-LINE-NUM				REALCICS
	   MOVE 001 TO DFH-FLAG (02)					REALCICS
           MOVE '8' TO DFH-DATA-TYPE (02)                               REALCICS
           MOVE '8 ' TO DFH-DATA-CLASS (02)                             REALCICS
           MOVE 'STF00002' TO DFH-DATA8 (02)                            REALCICS
	   SET DFH-ADDR (02) TO ADDRESS OF DFH-DATA8 (02)		REALCICS
	   ADD 0 LENGTH OF DFH-DATA8 (02) GIVING DFH-SIZE (02)		REALCICS
	   MOVE 001 TO DFH-FLAG (04)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (04)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (04)                              REALCICS
	   SET DFH-ADDR (04) TO ADDRESS OF WS-LOG			REALCICS
	   ADD 0 LENGTH OF WS-LOG GIVING DFH-SIZE (04)			REALCICS
	   MOVE 001 TO DFH-FLAG (06)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (06)                               REALCICS
           MOVE ' ' TO DFH-DATA-CLASS (06)                              REALCICS
	   SET DFH-ADDR (06) TO ADDRESS OF LOG-TIX-ID			REALCICS
	   ADD 0 LENGTH OF LOG-TIX-ID GIVING DFH-SIZE (06)		REALCICS
	   MOVE 001 TO DFH-FLAG (01)					REALCICS
           MOVE '1' TO DFH-DATA-TYPE (01)                               REALCICS
           MOVE 'H ' TO DFH-DATA-CLASS (01)                             REALCICS
	   SET DFH-ADDR (01) TO ADDRESS OF WS-RES-CODE			REALCICS
	   ADD 0 LENGTH OF WS-RES-CODE GIVING DFH-SIZE (01)		REALCICS
           MOVE X'0604' TO DFH-COMMAND EIBFN                            REALCICS
	   MOVE 006 TO DFH-VARS-COUNT					REALCICS
           CALL 'CICS_Exec_Std' USING CICSICB GIVING DFH-RETURN-STATUS  REALCICS
           IF DFH-RETURN-STATUS = -1 CALL 'CICS_Link_Abend' USING       REALCICS
	       CICSICB END-IF						REALCICS
	   IF DFH-RETURN-STATUS < 0 STOP RUN				REALCICS
	   ELSE IF DFH-RETURN-STATUS > 0 PERFORM DFH-GOTO-HANDLE	REALCICS
	       END-IF END-IF						REALCICS
	   ADD 0 DFH-RESP GIVING WS-RES-CODE				REALCICS
	   .								REALCICS
      *$PP-LIST 							REALCICS


       1000-VALIDATION.

	   IF EIBAID = DFHPF3

      *$PP-DEBUG							REALCICS
      P      EXEC CICS XCTL
      P       PROGRAM('SM000')
      P      END-EXEC
      *$PP-NOLIST							REALCICS
           MOVE 'SM03P' TO DFH-SOURCE-NAME                              REALCICS
	   MOVE 1012 TO DFH-SOURCE-LINE-NUM				REALCICS
	   MOVE 001 TO DFH-FLAG (02)					REALCICS
           MOVE '2' TO DFH-DATA-TYPE (02)                               REALCICS
           MOVE '8 ' TO DFH-DATA-CLASS (02)                             REALCICS
           MOVE 'SM000' TO DFH-DATA8 (02)                               REALCICS
	   SET DFH-ADDR (02) TO ADDRESS OF DFH-DATA8 (02)		REALCICS
	   ADD 0 LENGTH OF DFH-DATA8 (02) GIVING DFH-SIZE (02)		REALCICS
           MOVE X'0E04' TO DFH-COMMAND EIBFN                            REALCICS
	   MOVE 002 TO DFH-VARS-COUNT					REALCICS
           CALL 'CICS_Exec_Std' USING CICSICB GIVING DFH-RETURN-STATUS  REALCICS
           IF DFH-RETURN-STATUS = -1 CALL 'CICS_Link_Abend' USING       REALCICS
	       CICSICB END-IF						REALCICS
	   IF DFH-RETURN-STATUS < 0 STOP RUN				REALCICS
	   ELSE IF DFH-RETURN-STATUS > 0 PERFORM DFH-GOTO-HANDLE	REALCICS
	       END-IF END-IF						REALCICS
      *$PP-LIST 							REALCICS

	   END-IF


	   IF EIBAID = DFHPF5
	      PERFORM 700-READ-FILE
              IF WS-INIT = 'X'
              MOVE 'UPDATE ABORTED' TO ERRMSGO
	      MOVE DFHBMUNP TO TIXTTLA
	      MOVE DFHBMUNP TO TIXDESC1A
	      MOVE DFHBMUNP TO TIXDESC2A
	      MOVE DFHBMUNP TO UPDRMKA
	      MOVE DFHBMUNP TO UPDRMK1A
	      MOVE DFHBMUNP TO STATA
	      MOVE TIX-TITLE TO TIXTTLO
	      MOVE TIX-DESC1 TO TIXDESC1O
	      MOVE TIX-DESC2 TO TIXDESC2O
	      MOVE LAST-UPDATE-REM1 TO UPDRMKO
	      MOVE LAST-UPDATE-REM2 TO UPDRMK1O
	      MOVE TIX-STATUS TO STATO
	      MOVE TIX-REQUESTOR TO REQBYO
	      MOVE UPDATED-BY2 TO UPDBYO
	      MOVE LAST-UPDATE-DATE TO DATE1O
	      MOVE LAST-UPDATE-TIME TO TIME1O
              MOVE 'Y' TO WS-INIT
	      PERFORM 110-NEW-MAP
	      ELSE

              MOVE 'UPDATE ABORTED' TO ERRMSGO
	      MOVE SPACES TO WS-TICKET-NUM
	      MOVE DFHBMUNP TO TIXNUMA
	      MOVE SPACES TO TIXNUMO
	      MOVE SPACES TO TIXTTLO
	      MOVE SPACES TO TIXDESC1O
	      MOVE SPACES TO TIXDESC2O
	      MOVE SPACES TO UPDRMKO
	      MOVE SPACES TO UPDRMK1O
	      MOVE SPACES TO STATO
	      MOVE SPACES TO REQBYO
	      MOVE SPACES TO UPDBYO
	      MOVE SPACES TO DATE1O
	      MOVE SPACES TO TIME1O

	      MOVE DFHBMPRO TO REQBYA
	      MOVE DFHBMPRO TO STATA
	      MOVE DFHBMPRO TO TIXTTLA
	      MOVE DFHBMPRO TO TIXDESC1A
	      MOVE DFHBMPRO TO TIXDESC2A
	      MOVE DFHBMPRO TO DATE1A
	      MOVE DFHBMPRO TO TIME1A
	      MOVE DFHBMPRO TO UPDRMKA
	      MOVE DFHBMPRO TO UPDRMK1A
	      MOVE 2 TO WS-PROG-STATE
	      PERFORM 110-NEW-MAP
	      END-IF


	   END-IF

	   IF EIBAID = DFHCLEAR OR EIBAID = DFHPF1
	   OR EIBAID = DFHPF4 OR EIBAID = DFHPF6 OR EIBAID = DFHPF7
	   OR EIBAID = DFHPF8 OR EIBAID = DFHPF9 OR EIBAID = DFHPF10
	   OR EIBAID = DFHPF12
	    PERFORM 700-READ-FILE
             IF WS-INIT = 'X'
	      MOVE DFHBMUNP TO TIXTTLA
	      MOVE DFHBMUNP TO TIXDESC1A
	      MOVE DFHBMUNP TO TIXDESC2A
	      MOVE DFHBMUNP TO UPDRMKA
	      MOVE DFHBMUNP TO UPDRMK1A
	      MOVE DFHBMUNP TO STATA
	      MOVE DFHBMPRO TO REQBYA

	     MOVE WS-TICKET-NUM TO TIXNUMO
	     MOVE WS-TCKREQ TO REQBYO
	     MOVE WS-TCKTTL TO TIXTTLO
	     MOVE WS-TCKDESC(1:50) TO TIXDESC1O
	     MOVE WS-TCKDESC(51:50) TO TIXDESC2O
	     MOVE WS-TCKSTAT TO STATO
	     MOVE WS-LSTUPDRMK(1:25) TO UPDRMKO
	     MOVE WS-LSTUPDRMK(26:25) TO UPDRMK1O
	     MOVE WS-LSTUPD(1:10) TO DATE1O
	     MOVE WS-LSTUPD(11:10) TO TIME1O
	     MOVE WS-STUPDBY TO UPDBYO
             MOVE 'INVALID PFKEY PRESSED' TO ERRMSGO

	     PERFORM 110-NEW-MAP
	    ELSE
	       MOVE DFHBMUNP TO TIXTTLA
	      MOVE DFHBMUNP TO TIXDESC1A
	      MOVE DFHBMUNP TO TIXDESC2A
	      MOVE DFHBMUNP TO UPDRMKA
	      MOVE DFHBMUNP TO UPDRMK1A
	      MOVE DFHBMUNP TO STATA
	      MOVE DFHBMPRO TO REQBYA

	     MOVE WS-TICKET-NUM TO TIXNUMO
	     MOVE TIX-REQUESTOR TO REQBYO
	     MOVE TIX-TITLE TO TIXTTLO
	     MOVE TIX-DESC1 TO TIXDESC1O
	     MOVE TIX-DESC2 TO TIXDESC2O
	     MOVE TIX-STATUS TO STATO
	     MOVE LAST-UPDATE-REM1 TO UPDRMKO
	     MOVE LAST-UPDATE-REM2 TO UPDRMK1O
	     MOVE LAST-UPDATE-DATE TO DATE1O
	     MOVE LAST-UPDATE-TIME TO TIME1O
	     MOVE UPDATED-BY2 TO UPDBYO
             MOVE 'INVALID PFKEY PRESSED WS3' TO ERRMSGO
	     PERFORM 110-NEW-MAP
	   END-IF.

      *$PP-NOLIST CICS HI						REALCICS
       DFH-END SECTION. 						REALCICS
       DFH-CALL-END.							REALCICS
           MOVE 'SM03P' TO DFH-SOURCE-NAME                              REALCICS
	   MOVE 1126 TO DFH-SOURCE-LINE-NUM				REALCICS
	   MOVE LOW-VALUE TO DFH-COMMAND				REALCICS
           CALL 'CICS_Module_End' USING CICSICB GIVING                  REALCICS
	       DFH-RETURN-STATUS					REALCICS
	   GOBACK.							REALCICS
       DFH-GOTO-HANDLE. 						REALCICS
      *$PP-LIST CICS HI 						REALCICS